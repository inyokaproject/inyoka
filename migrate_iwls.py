#!/usr/bin/env python2
# -*- coding: utf-8 -*-
#
# Download the `.tar.gz` and the python script.
#
# Run the script like the following:
#
# ```
# $ python manage.py shell
# Python 2.7.16 (default, Mar 11 2019, 18:59:25)
# [GCC 8.2.1 20181127] on linux2
# Type "help", "copyright", "credits" or "license" for more information.
# (InteractiveConsole)
# >>> import migrate_iwls
# >>> migrate_iwls.main()
# ```

import tarfile

import requests
from inyoka.portal.models import Linkmap
from django.conf import settings
import re
import os
from os import path

icon_dest = 'linkmap/icons'
icon_dest_fullpath = path.join(settings.MEDIA_ROOT, icon_dest)

token_to_media_path = {u'kubuntu-de': u'linkmap/icons/kubuntu-de.png', u'ubuntuone': u'linkmap/icons/ubuntuone.png', u'derstandard': u'linkmap/icons/derstandard.png', u'osm': u'linkmap/icons/osm.png', u'ubuntu_doc': u'linkmap/icons/ubuntu_doc.png', u'ubuntugnome': u'linkmap/icons/ubuntugnome.png', u'launchpad': u'linkmap/icons/launchpad.png', u'freenode': u'linkmap/icons/freenode.png', u'prolinux': u'linkmap/icons/prolinux.png', u'xfcedocs': u'linkmap/icons/xfcedocs.png', u'holarse': u'linkmap/icons/holarse.png', u'gnomeprojects': u'linkmap/icons/gnomeprojects.png', u'brainstorm': u'linkmap/icons/brainstorm.png', u'vimeo': u'linkmap/icons/vimeo.png', u'lpuser': u'linkmap/icons/lpuser.png', u'duckduckgo': u'linkmap/icons/duckduckgo.png', u'kubuntu': u'linkmap/icons/kubuntu.png', u'canonicalsubdomain': u'linkmap/icons/canonicalsubdomain_.png', u'gnomelook': u'linkmap/icons/gnomelook.png', u'kubuntu_doc': u'linkmap/icons/kubuntu.png', u'opensuse': u'linkmap/icons/opensuse.jpg', u'ubunturesources': u'linkmap/icons/ubunturesources.png', u'desura': u'linkmap/icons/desura.png', u'ticket': u'linkmap/icons/ticket.png', u'ubuntumate': u'linkmap/icons/ubuntumate.png', u'archwiki': u'linkmap/icons/archwiki.png', u'blogspot': u'linkmap/icons/blogspot.png', u'team': u'linkmap/icons/team.png', u'heise': u'linkmap/icons/heise.png', u'steam': u'linkmap/icons/steam.png', u'linuxgaming': u'linkmap/icons/linuxgaming.png', u'google': u'linkmap/icons/google.png', u'gameolith': u'linkmap/icons/gameolith.png', u'debian_de': u'linkmap/icons/debian_de.png', u'twitter': u'linkmap/icons/twitter.png', u'sourceforge2': u'linkmap/icons/sourceforge2.png', u'launchpad_answers': u'linkmap/icons/launchpad.png', u'lubuntu': u'linkmap/icons/lubuntu.png', u'wikibooks_en': u'linkmap/icons/wikibooks_en.png', u'calendar': u'linkmap/icons/calendar.png', u'canonical': u'linkmap/icons/canonical.png', u'gog': u'linkmap/icons/gog.png', u'wikipedia': u'linkmap/icons/wikipedia.png', u'startpage': u'linkmap/icons/startpage.png', u'freshmeat': u'linkmap/icons/freshmeat.png', u'uappexplorer': u'linkmap/icons/uappexplorer.png', u'ubuntu': u'linkmap/icons/ubuntu.png', u'packages': u'linkmap/icons/packages.png', u'ubuntuapps': u'linkmap/icons/ubuntuapps.png', u'gnome': u'linkmap/icons/gnome.png', u'freecode': u'linkmap/icons/freecode.png', u'debianbug': u'linkmap/icons/debianbug.png', u'diaspora': u'linkmap/icons/diaspora.png', u'xubuntu': u'linkmap/icons/xubuntu.png', u'pdf': u'linkmap/icons/pdf.png', u'user': u'linkmap/icons/user.png', u'googlecode': u'linkmap/icons/googlecode.png', u'isbn': u'linkmap/icons/isbn.png', u'wikimedia': u'linkmap/icons/wikimedia.png', u'uf_forum': u'linkmap/icons/uf_forum.png', u'omgubuntu': u'linkmap/icons/omgubuntu.png', u'kdebugs': u'linkmap/icons/kdebugs.png', u'ubuntu_fr': u'linkmap/icons/ubuntu_fr.png', u'indiedb': u'linkmap/icons/indiedb.png', u'wordpress': u'linkmap/icons/wordpress.png', u'uf_thread': u'linkmap/icons/uf_thread.png', u'moddb': u'linkmap/icons/moddb.png', u'scope': u'linkmap/icons/scope.png', u'lgdb': u'linkmap/icons/lgdb.png', u'ean': u'linkmap/icons/ean.png', u'lpcode': u'linkmap/icons/lpcode.png', u'bug': u'linkmap/icons/bug.png', u'wikibooks': u'linkmap/icons/wikibooks.png', u'ml': u'linkmap/icons/ml.png', u'man_de': u'linkmap/icons/man_de.png', u'playdeb': u'linkmap/icons/playdeb.png', u'getdeb': u'linkmap/icons/getdeb.png', u'identica': u'linkmap/icons/identica.png', u'gnomeapps': u'linkmap/icons/gnomeapps.png', u'iawm': u'linkmap/icons/iawm.png', u'humble': u'linkmap/icons/humble.png', u'sourceforge': u'linkmap/icons/sourceforge.png', u'uf_member': u'linkmap/icons/uf_member.png', u'ixquick': u'linkmap/icons/ixquick.png', u'atomicgamer': u'linkmap/icons/atomicgamer.png', u'canonicalvoices': u'linkmap/icons/canonicalvoices.png', u'ubuntusub': u'linkmap/icons/ubuntusub.png', u'lastfm': u'linkmap/icons/lastfm.png', u'askubuntu': u'linkmap/icons/askubuntu.png', u'launchpad2': u'linkmap/icons/launchpad2.png', u'wikipedia_en': u'linkmap/icons/wikipedia_en.png', u'ubuntustudio': u'linkmap/icons/ubuntustudio.png', u'canonicalblog': u'linkmap/icons/canonicalblog.png', u'liflg': u'linkmap/icons/liflg.jpg', u'fb': u'linkmap/icons/fb.png', u'ubuntufridge': u'linkmap/icons/ubuntufridge.png', u'dropbox': u'linkmap/icons/dropbox.png', u'quakenet': u'linkmap/icons/quakenet.png', u'debian': u'linkmap/icons/debian.png', u'man': u'linkmap/icons/man.png', u'bitbucket': u'linkmap/icons/bitbucket.png', u'github': u'linkmap/icons/github.png', u'freedesktop-software': u'linkmap/icons/freedesktop.png', u'freedesktop': u'linkmap/icons/freedesktop.png', u'edubuntu': u'linkmap/icons/edubuntu.png', u'ubuntudiscourse': u'linkmap/icons/ubuntudiscourse.png', u'youtube': u'linkmap/icons/youtube.png', u'mythbuntu': u'linkmap/icons/mythbuntu.png', u'moby': u'linkmap/icons/moby.png'}


def write_images_to_media():
    if not path.exists(icon_dest_fullpath):
        os.makedirs(icon_dest_fullpath)

    if token_to_media_path:
        with tarfile.open('iwl_icons.tar.gz') as tar:
            tar.extractall(icon_dest_fullpath)
        return

    # to retrieve it
    # markup_css = requests.get('https://ubuntuusers.de/markup.css/')
    # markup_css = markup_css.content

    markup_css = 'a.ikhaya {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/56/15/ikhaya.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.paste {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/32/07/paste.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\n\r\n/* Bilder f\xc3\xbcr InterWiki */\r\n/*----------------------*/\r\na.interwiki-archwiki {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/10/33/archwiki.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-askubuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/49/16/askubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-atomicgamer {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/35/51/atomicgamer.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-bitbucket {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/41/45/bitbucket.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-blogspot {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/39/48/blogspot.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-brainstorm {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/23/40/brainstorm.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-bug {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/13/18/bug.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-calendar {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/54/07/calendar.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-canonical {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/18/16/canonical.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-canonicalblog {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/15/26/canonicalblog.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-canonicalsubdomain {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/03/52/canonicalsubdomain_.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-canonicalvoices {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/13/39/canonicalvoices.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-debian {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/04/09/debian.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-debianbug {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/34/29/debianbug.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-debian_de {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/22/40/debian_de.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-derstandard {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/41/11/derstandard.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-desura {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/57/08/desura.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-diaspora {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/35/39/diaspora.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-dropbox {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/39/20/dropbox.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-duckduckgo {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/11/06/duckduckgo.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ean {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/21/51/ean.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-edubuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/50/17/edubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-fb {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/33/18/fb.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-freecode {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/48/11/freecode.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-freedesktop {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/27/51/freedesktop.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-freedesktop-software {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/27/51/freedesktop.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-freenode {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/23/39/freenode.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-freshmeat {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/55/09/freshmeat.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-gameolith {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/50/15/gameolith.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-getdeb {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/15/18/getdeb.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-github {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/15/05/github.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-gnome {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/52/51/gnome.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-gnomeapps {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/27/03/gnomeapps.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-gnomeprojects {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/49/52/gnomeprojects.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-gog {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/47/04/gog.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-google {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/55/37/google.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-googlecode {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/36/18/googlecode.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-gnomelook {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/06/51/gnomelook.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-heise {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/08/09/heise.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-holarse {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/07/22/holarse.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-humble {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/37/18/humble.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-iawm {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/50/00/iawm.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-identica {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/22/18/identica.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-indiedb {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/30/45/indiedb.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-isbn {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/52/18/isbn.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ixquick {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/33/06/ixquick.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-kdebugs {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/53/05/kdebugs.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-kubuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/49/17/kubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-kubuntu-de {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/36/16/kubuntu-de.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-kubuntu_doc {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/49/17/kubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-lastfm {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/00/18/lastfm.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-launchpad {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/11/18/launchpad.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-launchpad2 {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/58/19/launchpad2.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-launchpad_answers {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/11/18/launchpad.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-lgdb {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/54/48/lgdb.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-liflg {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/23/22/liflg.jpg);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-linuxgaming {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/15/18/linuxgaming.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-lpcode {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/59/26/lpcode.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-lpuser {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/22/18/lpuser.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-lubuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/19/28/lubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-man {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/32/39/man.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-man_de {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/45/39/man_de.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ml {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/49/45/ml.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-moddb {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/32/28/moddb.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-moby {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/04/39/moby.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-mythbuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/06/48/mythbuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-opensuse {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/30/45/opensuse.jpg);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-osm {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/34/45/osm.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-omgubuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/52/19/omgubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-packages {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/37/47/packages.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-pdf {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/35/06/pdf.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-playdeb {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/55/09/playdeb.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-prolinux {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/32/09/prolinux.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-quakenet {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/57/05/quakenet.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-scope {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/39/13/scope.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-sourceforge {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/39/18/sourceforge.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-sourceforge2 {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/02/28/sourceforge2.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-startpage {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/00/23/startpage.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-steam {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/07/37/steam.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-team {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/04/18/team.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n  color:#597A00;\r\n}\r\n\r\na.interwiki-ticket {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/31/16/ticket.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-twitter {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/56/44/twitter.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-uappexplorer {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/25/22/uappexplorer.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/56/18/ubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntuapps {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/56/47/ubuntuapps.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntudiscourse {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/19/46/ubuntudiscourse.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntufridge {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/25/46/ubuntufridge.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntugnome {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/02/43/ubuntugnome.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntumate {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/31/13/ubuntumate.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubunturesources {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/00/46/ubunturesources.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntusub {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/06/46/ubuntusub.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-uf_forum {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/09/38/uf_forum.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-uf_member {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/48/38/uf_member.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-uf_thread {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/17/38/uf_thread.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntu_doc {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/52/40/ubuntu_doc.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntu_fr {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/31/40/ubuntu_fr.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntustudio {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/13/40/ubuntustudio.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-ubuntuone {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/17/05/ubuntuone.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-user {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/22/18/user.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-vimeo {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/16/29/vimeo.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-wikibooks {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/18/09/wikibooks.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-wikibooks_en {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/03/51/wikibooks_en.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-wikimedia {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/30/09/wikimedia.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-wikipedia {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/29/41/wikipedia.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-wikipedia_en {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/45/41/wikipedia_en.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-wordpress {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/25/40/wordpress.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-xfcedocs {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/24/28/xfcedocs.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-xubuntu {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/46/28/xubuntu.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}\r\n\r\na.interwiki-youtube {\r\n  background-image: url(//media-cdn.ubuntu-de.org/wiki/attachments/59/47/youtube.png);\r\n  background-repeat: no-repeat;\r\n  padding-left: 20px;\r\n}'
    markup_css = markup_css.splitlines()

    start_of_iwl_css = u'/* Bilder f√ºr InterWiki */'
    token_re = re.compile(r"a\.interwiki-(?P<token>[1-9a-z_-]+) \{")
    icon_url_re = re.compile(r"  background-image: url\((?P<icon_url>.+)\);")

    position = 0
    header_found = False
    while position < len(markup_css):
        l = markup_css[position].decode('utf-8')

        if header_found:
            token = token_re.match(l).group('token')

            icon_url = icon_url_re.match(markup_css[position+1]).group('icon_url')
            icon_url = 'https:' + icon_url
            icon = requests.get(icon_url)

            icon_basename = path.basename(icon.url)
            file_dest = path.join(icon_dest_fullpath, icon_basename)

            with open(file_dest, 'w') as f:
                f.write(icon.content)

            token_to_media_path[token] = icon_dest + '/' + icon_basename

            # skip following lines
            position += 5
            if token == 'team':
                position += 1
        else:
            if l == start_of_iwl_css:
                header_found = True
                position += 1  # skip separator line

        position += 1


def insert_into_db():
    # to retrieve it
    # response = requests.get('https://wiki.ubuntuusers.de/Wiki/InterWikiMap/a/export/raw/')
    # lines = response.content

    lines = '# X-Behave: Interwiki-Map\r\n\r\n{{{\r\napt = apt:\r\narchwiki = https://wiki.archlinux.org/index.php/\r\naskubuntu = https://askubuntu.com/questions/\r\nbehind = https://behind.ubuntuusers.de/\r\nbitbucket = https://bitbucket.org/\r\nblogspot = https://$PAGE.blogspot.de/\r\nbox = https://app.box.com/\r\nbug = https://launchpad.net/bugs/\r\ncalendar = https://ubuntuusers.de/calendar/\r\ncanonical = https://www.canonical.com/\r\ncanonicalblog = https://blog.canonical.com/\r\ncanonicalsubdomain = https://$PAGE.canonical.com/\r\ncanonicalvoices = https://voices.canonical.com/\r\ncategory = https://forum.ubuntuusers.de/category/\r\ndebian = https://wiki.debian.org/\r\ndebianbug = https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=\r\ndebian_de = https://wiki.debian.org/de/\r\nderstandard = https://derstandard.at/\r\ndesura = https://www.desura.com/games/\r\ndiaspora = https://joindiaspora.com/tags/\r\ndropbox = https://dl.dropbox.com/\r\nduckduckgo = https://duckduckgo.com/?q=$PAGE&kl=de-de\r\nean = https://www.google.de/#q=\r\nedubuntu = https://www.edubuntu.org/\r\next_de = https:\r\next_en = https://\r\nfb = https://www.facebook.com/\r\nfind-link = https://startpage.com/do/search?query=host:wiki.ubuntuusers.de+link:\r\nforum = https://forum.ubuntuusers.de/forum/\r\nfreedesktop = https://bugs.freedesktop.org/show_bug.cgi?id=\r\nfreedesktop-software = https://freedesktop.org/wiki/Software/\r\nfreenode = https://webchat.freenode.net/?channels=#\r\nfreshmeat = http://freshmeat.sourceforge.net/projects/\r\ngetdeb = http://www.getdeb.net/software/\r\ngithub = https://github.com/\r\ngnome = https://bugzilla.gnome.org/show_bug.cgi?id=\r\ngnomeapps = https://wiki.gnome.org/Apps/\r\ngnomeprojects = https://wiki.gnome.org/Projects/\r\ngog = https://www.gog.com/game/\r\ngoogle = https://www.google.de/search?q=\r\ngooglecode = https://code.google.com/p/\r\nheise = https://www.heise.de/\r\nholarse = https://www.holarse-linuxgaming.de/wiki/\r\nhumble = https://www.humblebundle.com/store/p/\r\niawm = https://web.archive.org/web/*/https://\r\nidentica = https://identi.ca/\r\nikhaya = https://ikhaya.ubuntuusers.de/\r\nindiedb = https://www.indiedb.com/games/\r\nisbn = http://www.isbn-suchen.de/search.php5?q=\r\nixquick = https://ixquick.com/do/search?cat=web&cmd=process_search&language=deutsch&query=$PAGE&ff=\r\nkdebugs = https://bugs.kde.org/show_bug.cgi?id=\r\nkubuntu = https://www.kubuntu.org/\r\nkubuntu-de = https://wiki.kubuntu-de.org/\r\nkubuntu_doc = https://wiki.kubuntu.org/\r\nlastfm = https://www.last.fm/de/group/\r\nlaunchpad = https://launchpad.net/\r\nlaunchpad2 = https://$PAGE.launchpad.net/\r\nlaunchpad_answers = https://answers.launchpad.net/questions/\r\nlgdb = https://www.lgdb.org/\r\nliflg = https://liflg.org/?catid=\r\nlinuxgaming = https://wiki.linuxgaming.de/index.php/\r\nlpcode = https://code.launchpad.net/\r\nlpuser = https://launchpad.net/~\r\nlubuntu = https://lubuntu.net/\r\nman = https://manpages.ubuntu.com/cgi-bin/search.py?lr=lang_en&q=\r\nman_de = https://manpages.ubuntu.com/cgi-bin/search.py?lr=lang_de&q=\r\nml = https://lists.ubuntu.com/archives/\r\nmoby = https://www.mobygames.com/game/\r\nmoddb = https://www.moddb.com/\r\nmythbuntu = http://www.mythbuntu.org/\r\nomgubuntu = https://www.omgubuntu.co.uk/\r\nopensuse = https://de.opensuse.org/\r\nopenstore = https://open-store.io/app/\r\nopenstore2 = openstore://\r\nosm = https://wiki.openstreetmap.org/wiki/\r\npackages = https://packages.ubuntu.com/\r\npaste = https://paste.ubuntuusers.de/\r\npdf = https://\r\nplaydeb = https://www.playdeb.net/software/\r\npost = https://forum.ubuntuusers.de/post/\r\nprolinux = https://www.pro-linux.de/\r\nquakenet = https://webchat.quakenet.org/?channels=\r\nscope = scope://com.canonical.scopes.clickstore?q=\r\nsourceforge = https://sourceforge.net/projects/\r\nsourceforge2 = http://$PAGE.sourceforge.net\r\nstackoverflow = https://stackoverflow.com/questions/\r\nstartpage = https://startpage.com/do/search?cat=web&language=deutsch&query=$PAGE&ff=\r\nsteam = https://store.steampowered.com/$PAGE?l=german\r\ntag = https://wiki.ubuntuusers.de/wiki/tags/\r\nticket = https://trac.ubuntuusers.de/ticket/\r\ntopic = https://forum.ubuntuusers.de/topic/\r\ntwitter = https://twitter.com/\r\nuappexplorer = https://uappexplorer.com/app/\r\nubuntu = https://wiki.ubuntu.com/\r\nubuntuapps = https://apps.ubuntu.com/cat/applications/\r\nubuntufridge = https://fridge.ubuntu.com/\r\nubuntugnome = https://ubuntugnome.org/\r\nubuntumate = https://ubuntu-mate.org/\r\nubunturesources = https://resources.ubuntu.com/\r\nubuntustudio = https://ubuntustudio.org/\r\nubuntusub = https://$PAGE.ubuntu.com/\r\nubuntu_doc = https://help.ubuntu.com/\r\nubuntu_fr = https://doc.ubuntu-fr.org/\r\nubuntu_it = https://wiki.ubuntu-it.org/\r\nuf_forum = https://ubuntuforums.org/forumdisplay.php?f=\r\nuf_member = https://ubuntuforums.org/member.php?u=\r\nuf_thread = https://ubuntuforums.org/showthread.php?t=\r\nvimeo = https://vimeo.com/\r\nwikibooks = https://de.wikibooks.org/wiki/\r\nwikibooks_en = https://en.wikibooks.org/wiki/\r\nwikimedia = https://commons.wikimedia.org/wiki/\r\nwikipedia = https://de.wikipedia.org/wiki/\r\nwikipedia_en = https://en.wikipedia.org/wiki/\r\nwordpress = https://$PAGE.wordpress.com/\r\nxfcedocs = https://docs.xfce.org/\r\nxubuntu = https://www.xubuntu.org/\r\nyoutube = https://www.youtube.com/watch?v=\r\n}}}'
    lines = lines.splitlines()
    lines = lines[3:-1]  # drop lines at start and end, as it does not contain any iwl, just comments and {{{ }}}

    for l in lines:
        token, url = l.split(' = ', 1)

        if token in ('pdf', 'openstore2', 'ext_de', 'ext_en', 'scope', 'apt'):
            continue

        url = url.replace('$PAGE', 'PAGE')  # so the value is still a valid domain for URLField
        l = Linkmap.objects.create(token=token, url=url,
                                   icon=token_to_media_path.get(token, ''))


def main():
    write_images_to_media()
    insert_into_db()
