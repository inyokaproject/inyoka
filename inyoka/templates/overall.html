{#
    overall.html
    ~~~~~~~~~~~~

    This is the basic layout that is included by all templates.

    It contains the design elements that are displayed on all pages.

    :copyright: (c) 2007-2012 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
-#}
{% from 'macros.html' import breadcrumb, render_modnavi_li %}
{{- XHTML_DTD }}
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:cc="http://creativecommons.org/ns#"
      xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
      xmlns:dc="http://purl.org/dc/elements/1.1/"
      xml:lang="de" lang="de" dir="ltr">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>
      {{ BREADCRUMB.render('title') }}
    </title>
    {%- block html_head %}
      {%- if deny_robots %}
        <meta name="robots" content="{% if deny_robots == true %}noindex, nofollow{% else %}{{ deny_robots }}{% endif %}" />
      {%- endif %}
      {#- This way the local stylesheets can override styles without problems. #}
      {%- set styles = ['main-sprite', 'markup'] + styles|default([]) -%}
      {%- for style in styles %}
        {%- if SETTINGS.DEBUG %}
          {% set style = style.split('-sprite', 1)[0] %}
          <link rel="stylesheet/less" type="text/css"
                href="{{ href('static', 'style', '%s.less'|format(style)) }}" />
        {%- else %}
          <link rel="stylesheet" type="text/css"
                href="{{ href('static', 'style', '%s.css'|format(style)) }}" />
        {% endif %}
      {%- endfor %}

      <link rel="stylesheet" type="text/css"
            href="{{ href('portal', 'markup.css') }}" />
      {%- if SETTINGS.DEBUG %}
        <link rel="stylesheet/less" type="text/css"
              href="{{ href('static', 'style', 'print.less') }}" media="print" />
      {%- else %}
        <link rel="stylesheet" type="text/css"
              href="{{ href('static', 'style', 'print.css') }}" media="print" />
      {%- endif %}

      {%- for title, url in feeds %}
        <link rel="alternate" href="{{ url|e }}" title="{{ title|e }}"
              type="application/atom+xml" />
      {%- endfor %}
      <link rel="shortcut icon" href="{{ href('static', 'img', 'favicon.ico') }}" />
      <link rel="search" type="application/opensearchdescription+xml"
            title="ubuntuusers" href="{{ href('portal', 'opensearch', 'portal') }}" />
      {%- for app in ('forum', 'wiki', 'ikhaya', 'planet') %}
        {%- if app == active_app %}
          <link rel="search" type="application/opensearchdescription+xml"
                title="{{ SETTINGS.BASE_DOMAIN_NAME }} - {{ app|capitalize }}"
                href="{{ href('portal', 'opensearch', app) }}" />
        {%- endif -%}
      {%- endfor %}
      <script type="text/javascript" src="{{ href('portal', 'jsi18n') }}"></script>
      <script type="text/javascript">
      /*<![CDATA[*/
        var
          $STATIC_URL = {{ href('static')|jsonencode }},
          $MEDIA_URL = {{ href('media')|jsonencode }},
          $BASE_DOMAIN_NAME = {{ SETTINGS.BASE_DOMAIN_NAME|jsonencode }},
          $CURRENT_USER = {{ USER.username|jsonencode if USER.is_authenticated else 'null' }},
          $IS_LOGGED_IN = {{ USER.is_authenticated and 'true' or 'false' }},
          $SIDEBAR_HIDDEN = {{ USER.settings.portal_sidebar_hidden and 'true' or 'false' }};
      /*]]>*/
      </script>
      {%- if SETTINGS.DEBUG %}
        {% set suffix = SETTINGS.DEBUG and '.js' or '.min.js' %}
        <script type="text/javascript"
                src="{{ href('static', 'js/less-1.1.3%s'|format(suffix)) }}"></script>
      {% endif %}

      <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
      {% if SETTINGS.DEBUG %}
        <script>window.jQuery || document.write("<script src='{{ href('static', 'js/jquery-1.5.2.js') }}'>\x3C/script>")</script>
      {% else %}
        <script>window.jQuery || document.write("<script src='{{ href('static', 'js/jquery-1.5.2.min.js') }}'>\x3C/script>")</script>
      {% endif %}
    {%- endblock %}
  </head>
  <body>
   <div class="wrap"><div class="wrap2"><div class="wrap3"><div class="wrap4"><div class="wrap5">
    <div class="header">
      <h1><a href="/"><span>{{ SETTINGS.BASE_DOMAIN_NAME }}</span></a></h1>
      <ul class="tabbar">
        {%- for app in ('portal', 'forum', 'wiki', 'ikhaya', 'planet') %}
          <li class="{{ app }}{% if app == active_app %} active{% endif %}">
            <div class="tab_left"></div>
            <div class="tab_center"><a href="{{ href(app) }}">{{ app|capitalize }}<span></span></a></div>
            <div class="tab_right"></div>
          </li>
        {%- endfor %}
        {# TODO: uu specific #}
        <li class="community">
          <div class="tab_left"></div>
          <div class="tab_center"><a href="{{ href('wiki','Mitmachen') }}">Mitmachen<span></span></a></div>
          <div class="tab_right"></div>
        </li>
      </ul>{# .tabbar #}
    </div>{# .header #}

    <div class="body">
      <div class="appheader">
        {%- if not hide_quicklinks %}
          <ul class="navi_global">
            {%- if USER.is_authenticated %}
              <li>
                <a href="{{ href('portal', 'logout', next=CURRENT_URL) }}">
                  {% trans user=USER.username|e %}Logout [{{ user }}]{% endtrans %}
                </a>
              </li>
              <li>
                <a href="{{ href('portal', 'usercp') }}">
                  {% trans %}Control panel{% endtrans %}
                </a>
              </li>
              <li>
                {%- if pm_count -%}
                  <strong>
                    <a href="{{ href('portal', 'privmsg')}}">
                      {% trans count=pm_count %}Private messages ({{ count }}){% endtrans %}
                    </a>
                  </strong>
                {%- else -%}
                  <a href="{{ href('portal', 'privmsg') }}">
                    {% trans %}Private messages{% endtrans %}
                  </a>
                {%- endif -%}
              </li>
            {%- else %}
              <li>
                <a href="{{ href('portal', 'login', next=CURRENT_URL) }}" id="login_link">
                  {% trans %}Login{% endtrans %}
                </a>
              </li>
              <li>
                <a href="{{ href('portal', 'register') }}">
                  {% trans %}Register{% endtrans %}
                </a>
              </li>
            {%- endif %}
          </ul>{# .navi_global #}
        {%- endif %}
        {%- if USER.can('manage_topics') or USER.can('article_edit') or USER.can('event_edit') %}
          <div id="admin_menu">
            <div class="bar">
              <a id="admin_layer_button">
                <img src="{{ href('static', 'img/admin/switch.png') }}"
                     alt="{% trans %}Admin{% endtrans %}"
                     title="{% trans %}Turn admin links on/off{% endtrans %}" />
                <span class="description"></span>
              </a>
            </div>
            <div class="bar">
              {%- if USER.can('manage_topics') %}
                {{ render_modnavi_li(_('Reported topics'), href('forum', 'reported_topics'), href('static', 'img/admin/report.png'), report_count) }}
              {%- endif %}
              {%- if USER.can('article_edit') %}
                {% set label = _('Article suggestions') %}
                {{ render_modnavi_li(label, href('ikhaya', 'suggestions'), href('static', 'img/admin/article.png'), suggestion_count) }}
              {%- endif %}
              {%- if USER.can('article_edit') %}
                {% set label = _('Spelling mistakes') %}
                {{ render_modnavi_li(label, href('ikhaya', 'reports'), href('static', 'img/admin/spelling.png'), article_report_count) }}
              {%- endif %}
              {%- if USER.can('event_edit') %}
                {% set label = _('Event suggestions') %}
                {{ render_modnavi_li(label, href('ikhaya', 'events', 'invisible'), href('static', 'img/admin/event.png'), event_count) }}
              {%- endif %}
            </div>
          <noscript><strong class="nojs error">{{ _('Please turn on JavaScript!') }}</strong></noscript>
          </div>
        {%- endif %}
        {{ BREADCRUMB.render('appheader') }}
      </div>{# .appheader #}

      <div class="pathbar">

        <form action="{{ href('portal', 'search') }}" method="get" class="search">
          <div>
            <input type="text" name="query" class="search_query" value="{{ query|e }}" />
            {%- if topic %}
              <input type="hidden" name="topic_id" value="{{ topic.id }}" />
            {%- elif forum %}
              <input type="hidden" name="forum_id" value="{{ forum.id }}" />
            {%- endif %}
            <select name="area" class="search_area">
              <option value="all"{% if active_app == 'portal' %} selected="selected"{% endif %}>
                {% trans %}Overall{% endtrans %}
              </option>
              <option value="forum"{% if active_app == 'forum' %} selected="selected"{% endif %}>
                {% trans %}Forum{% endtrans %}
              </option>
              <option value="wiki"{% if active_app == 'wiki' %} selected="selected"{% endif %}>
                {% trans %}Wiki{% endtrans %}
              </option>
              <option value="ikhaya"{% if active_app == 'ikhaya' %} selected="selected"{% endif %}>
                {% trans %}News{% endtrans %}
              </option>
              <option value="planet"{% if active_app == 'planet' %} selected="selected"{% endif %}>
                {% trans %}Planet{% endtrans %}
              </option>
            </select>
            <input type="submit" value="{% trans %}Search{% endtrans %}" class="search_submit" />
          </div>
        </form>{# .search #}

        {% block pathbar_extensions %}
        {% endblock %}

        {{ BREADCRUMB.render('breadcrumb') }}

      </div>{# .pathbar #}

      {%- if GLOBAL_MESSAGE %}
        <div class="message global">{{ GLOBAL_MESSAGE }}</div>
      {%- endif %}

      {%- for message in MESSAGES %}
        <div class="message{% if message.success == true %} success{% elif message.success == false %} fail{% endif %}">
          {{ message.text }}
        </div>
      {%- endfor %}

      <div class="page_content">
        {% set tabbar = navi_type in ['tabbar', 'both'] %}
        {% set sidebar = navi_type in ['sidebar', 'both'] %}
        {%- if tabbar %}
        <div class="navi_tabbar navigation">
          {%- block tabbar %}{% endblock -%}
        </div>
        {%- endif %}
        {%- if sidebar %}
        <div class="navi_sidebar navigation">
          {%- block sidebar %}{% endblock -%}
        </div>
        {%- endif %}
        <div class="content{{ tabbar and ' content_tabbar' or '' }}{{ sidebar and ' content_sidebar' or '' }}">
          {%- block content %}{% endblock -%}
        </div>
      </div>
      <div style="clear: both;"></div>
      <div class="pathbar">{{ BREADCRUMB.render('breadcrumb') }}</div>
    </div>

    <div class="footer" style="clear: both;">
      <ul>
        <li class="poweredby">
          {% trans link=href('portal', 'inyoka') %}Powered by <a href="{{ link }}">Inyoka</a>{% endtrans %}
          {% if SETTINGS.DEBUG %}
            {% trans seconds=REQUEST.watch.duration|round(2) -%}
              (rendered in {{ seconds }} seconds)
            {%- endtrans %}
          {% endif %}
          <br />
          {%- if INYOKA_REVISION -%}
          Inyoka {{ INYOKA_REVISION['tag'] }}
            {%- if SETTINGS.DEBUG -%}
              -{{ INYOKA_REVISION['commit'] }}
            {%- endif -%}
          {%- else -%}
            Inyoka revision unavailable
          {%- endif -%}
        </li>
        <li class="license">
          <a href="?flavour=mobile" class="flavour_switch" >{% trans %}To mobile version{% endtrans %}</a><br />
          <img src="{{ href('static', 'img/copyleft.png') }}" alt="Copyleft" />
          2004 – 2011 ubuntuusers.de • Einige Rechte vorbehalten<br />
          <a href="http://creativecommons.org/licenses/by-nc-sa/2.0/de/deed.de" rel="license">CC</a> •
          <a href="{{ href('portal', 'lizenz') }}" rel="cc:morePermissions">Lizenz</a> •
          <a href="{{ href('portal', 'kontakt') }}">Kontakt</a> •
          <a href="{{ href('portal', 'datenschutz') }}">Datenschutz</a> •
          <a href="{{ href('portal', 'impressum') }}">Impressum</a>
        </li>
        <li class="housing">
          <span title="Unterbringung und Netzanbindung eines Servers">Serverhousing</span> gespendet von<br />
          <a href="http://www.noris.de/"><img src="{{ href('static', 'img/noris_logo.png') }}" alt="noris network" /></a>
        </li>
      </ul>
    </div>{# .footer #}
    <div style="clear: both;"></div>
   </div></div></div></div></div>

   {%- for script in ['classy', 'jquery.extensions', 'overall'] + scripts|default([]) %}
     {%- if SETTINGS.DEBUG %}
       <script type="text/javascript" src="{{ href('static', 'js/%s.js'|format(script)) }}"></script>
     {%- else %}
       <script type="text/javascript" src="{{ href('static', 'js/%s.min.js'|format(script)) }}"></script>
     {% endif %}
   {%- endfor %}
   {%- if SETTINGS.DEBUG %}
     <script type="text/javascript" src="{{ href('static', 'js/debug.js') }}"></script>
     <script type="text/javascript">
     /*<![CDATA[*/
     $(document).ready(function() {
       /* Designers Debug Tools */
       debugTools.init();
     });
     /*]]>*/
     </script>
   {% endif %}

   {% block additional_scripts %}
   {% endblock %}

    {%- if not USER.is_authenticated %}
    <form action="{{ href('portal', 'login', next=CURRENT_URL) }}" method="post" id="js_login_form">
      <div>
        <label for="js_login_username">
          {% trans %}Username or email address{% endtrans %}
        </label>
        <input name="username" id="js_login_username" />
        <label for="js_login_password">{% trans %}Password{% endtrans %}</label>
        <input type="password" name="password" id="js_login_password" />
        <label for="js_login_permanent"
               title="{% trans %}Don’t choose this option if you are using a public computer.{% endtrans %}">
          {% trans %}Keep me logged in{% endtrans %}
        </label>
        <input type="checkbox" name="permanent" id="js_login_permanent" />
        <a href="{{ href('portal', 'lost_password') }}">{% trans %}Lost password?{% endtrans %}</a>
        <input type="submit" value="Login" class="submit" />
        <input type="hidden" name="redirect" value="{{ CURRENT_URL|e }}" />
      </div>
    </form>

    <script type="text/javascript">
      var input = OpenIDHelper($('input[id="js_login_username"]'), {{ OPENID_PROVIDERS|jsonencode }});
    </script>
    {%- endif %}
  </body>
</html>
