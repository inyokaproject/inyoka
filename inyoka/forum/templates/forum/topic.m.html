{#
    forum/topic.m.html
    ~~~~~~~~~~~~~~~~~~

    This page shows a single topic for mobiles.

    :copyright: (c) 2007-2015 by the Inyoka Team, see AUTHORS for more details.
    :license: BSD, see LICENSE for more details.
#}
{% extends 'forum/page.m.html' %}
{% from 'macros.html' import render_pagination_mobile %}
{% set back = topic.forum|url %}
{% set rendered_pagination = render_pagination_mobile(pagination) %}

{% block content %}
  <h2>{{ topic.title|e }}</h2>
  {% if polls %}
    <form action="" method="post" class="poll">
      {{ csrf_token() }}
      {%- for poll in polls %}
        <div class="poll">
          <div><strong>{{ poll.question|e }}</strong></div>
          {%- for option in poll.options.all() %}
            <div class="option">
              {% if poll.can_vote and can_vote and not show_vote_results %}
                <input type="{{ poll.multiple_votes and 'checkbox' or 'radio' }}"
                       name="poll_{{ poll.id }}" id="option_{{ option.id }}"
                       value="{{ option.id }}" />
                <label for="option_{{ option.id }}">{{ option.name|e }}</label>
              {% else %}
                {% if not (poll.can_vote and can_vote) or show_vote_results %}
                  <div class="vote_bar_wrapper">
                    <div class="vote_bar" style="width: {{ option.percentage }}%;"></div>
                  </div>
                {% endif %}
                <span class="name">{{ option.name|e }}</span>
              {% endif %}
              {% if not (poll.can_vote and can_vote) or show_vote_results %}
                {% set bc, ac = (option.percentage|string).split('.') %}
                <span class="votes">
                  {{ bc }}{% if ac|int %}.{{ ac[:2] }}{% endif %}%
                  [ {{ option.votes }} ]
                </span>
              {% endif %}
            </div>
          {%- endfor %}
          <div class="meta">
            <span>
              {%- if poll.ended -%}
                {% trans start_date=poll.start_time|datetime, end_date=poll.end_time|datetime -%}
                  The poll was started on {{ start_date }} and it ended on {{ end_date }}.
                {%- endtrans %}
              {%- elif poll.end_time %}
                {% trans start_date=poll.start_time|datetime, end_date=poll.end_time|datetime -%}
                  The poll was started on {{ start_date }} and it will end on {{ end_date }}.
                {%- endtrans %}
              {%- endif -%}
            </span><br />
            <span>
              {% trans count=poll.votes %}{{ count }} vote{% pluralize %}{{ count }} votes{% endtrans %}
              {%- if poll.multiple_votes %},
                {% trans count=poll.votings.count() %}{{ count }} voter{% pluralize %}{{ count }} voters{% endtrans %}
              {%- endif %}
            </span>
          </div>
        </div>
      {%- endfor %}
      {%- if can_vote and not voted_all %}
        <div class="actions">
          {%- if show_vote_results %}
            <a href="?">{% trans %}Hide results{% endtrans %}</a>
          {%- else %}
            <input type="submit" name="vote" value="{% trans %}Vote{% endtrans %}" />
            <a href="?action=vote_results">{% trans %}Show results{% endtrans %}</a>
          {%- endif %}
        </div>
      {%- endif %}
    </form>
  {% endif %}
  <div class="pagination">{{ rendered_pagination }}</div>
  <section id="posts">
    {%- for post in posts if not post.hidden %}
      <div class="post" id="post-{{ post.id }}">
        <div class="meta">
          <a href="{{ post.author|url }}" class="author">
            {{ post.author.username|e }}
          </a>
          {% if can_reply and not topic.locked %}
            <a href="{{ post|url('quote') }}" class="action">
              {% trans %}Quote{% endtrans %}
            </a> |
          {% endif %}
          {% if can_edit(post) %}
            <a href="{{ post|url('edit') }}" class="action">
              {% trans %}Edit{% endtrans %}
            </a> |
          {% endif %}
          <a href="{{ post|url }}" class="date">
            {{ post.pub_date|datetime }}
          </a>
        </div>
        <div class="text">
          {{ post.get_text() }}
        </div>
        {% if post.has_attachments %}
          <div class="attachments">
            <div class="title">{% trans %}Attachments{% endtrans %}</div>
            <ul>
              {% for att in post.attachments.all() %}
                <a href="{{ att|url }}"><li>{{ att.name }}</li></a>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
    {%- endfor %}
  </section>
  <div class="pagination">{{ rendered_pagination }}</div>
  <div class="actions">
    <a href="{{ topic|url('reply')}}">{#
      #}<span>{% trans %}Reply{% endtrans %}</span>{#
    #}</a>
    {% if is_subscribed %}
      <a href="{{ topic|url('unsubscribe')}}">{#
        #}<span>{% trans %}Unsubscribe{% endtrans %}</span>{#
      #}</a>
    {% else %}
      <a href="{{ topic|url('subscribe')}}">{#
        #}<span>{% trans %}Subscribe{% endtrans %}</span>{#
      #}</a>
    {% endif %}
    <a href="{{ topic|url('report')}}">{#
      #}<span>{% trans %}Report{% endtrans %}</span>{#
    #}</a>
  </div>
{% endblock %}
