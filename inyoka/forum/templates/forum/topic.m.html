{#
    forum/topic.m.html
    ~~~~~~~~~~~~~~~~~~

    This page shows a single topic for mobiles.

    :copyright: (c) 2007-2011 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{% extends 'forum/page.m.html' %}
{% set back = topic.forum|url %}

{% block content %}
  <h2>{{ topic.title|e }}</h2>
  {% if polls %}
    <form action="" method="post" class="poll">
      {%- for poll in polls %}
        <div class="poll">
          <div><strong>{{ poll.question|e }}</strong></div>
          {%- for option in poll.options.all() %}
            <div class="option">
              {% if poll.can_vote and can_vote and not show_vote_results %}
                <input type="{{ poll.multiple_votes and 'checkbox' or 'radio' }}"
                       name="poll_{{ poll.id }}" id="option_{{ option.id }}"
                       value="{{ option.id }}" />
                <label for="option_{{ option.id }}">{{ option.name|e }}</label>
              {% else %}
                <div class="name">{{ option.name|e }}</div>
              {% endif %}
              {% if not (poll.can_vote and can_vote) or show_vote_results %}
                {% set bc, ac = (option.percentage|string).split('.') %}
                <div class="vote_bar_wrapper">
                  <div class="vote_bar" style="width: {{ option.percentage }}%;"></div>
                </div>
                <div class="votes">
                  <span>{{ bc }}{% if ac|int %}.{{ ac[:2] }}{% endif %}%</span>
                  <span>[ {{ option.votes }} ]</span>
                </div>
              {% endif %}
            </div>
          {%- endfor %}
          <div class="clear"></div>
          <div class="meta">
            <span>
              {%- if poll.ended -%}
                {% trans start_date=poll.start_time|dateformat, end_date=poll.end_time|dateformat -%}
                  The poll was started on {{ start_date }} and it ended on {{ end_date }}.
                {%- endtrans %}
              {%- elif poll.end_time %}
                {% trans start_date=poll.start_time|dateformat, end_date=poll.end_time|dateformat -%}
                  The poll was started on {{ start_date }} and it will end on {{ end_date }}.
                {%- endtrans %}
              {%- endif -%}
            </span><br />
            <span>
              {%- trans count=poll.votes %}Votes: {{ count }}{% pluralize %}Votes: {{ count }}{% endtrans -%}
            </span>
          </div>
      {%- endfor %}
      {%- if can_vote and not voted_all %}
        <p>
          {%- if show_vote_results %}
            <a href="?">{% trans %}Hide results{% endtrans %}</a>
          {%- else %}
            <input type="submit" name="vote" value="{% trans %}Vote{% endtrans %}" />
            <a href="?action=vote_results">{% trans %}Show results{% endtrans %}</a>
          {%- endif %}
        </p>
      {%- endif %}
    </form>
  {% endif %}
  {{ pagination.generate() }}
  <section id="posts">
    {%- for post in posts if not post.hidden %}
      <div class="post" id="post-{{ post.id }}">
        <div class="meta">
          <span class="right">
            {% if can_reply and not topic.locked %}
              <a href="{{ post|url('quote') }}"
                 class="action">{% trans %}Quote{% endtrans %}</a> |
            {% endif %}
            {% if can_edit(post) %}
              <a href="{{ post|url('edit') }}"
                 class="action">{% trans %}Edit{% endtrans %}</a> |
            {% endif %}
            <a href="{{ post|url }}">{{ post.pub_date|datetimeformat }}</a>
          </span>
          <span class="left">
            <a href="{{ post.author|url }}">{{ post.author.username|e }}</a>
          </span>
        </div>
        <div class="text">
          {{ post.get_text() }}
        </div>
        {% if post.has_attachments %}
          <div class="attachments">
            <div class="title">{% trans %}Attachments{% endtrans %}</div>
            <ul>
              {% for att in post.attachments.all() %}
                <a href="{{ att|url }}"><li class="button">{{ att.name }}</li></a>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
      </div>
    {%- endfor %}
  </section>
  {{ pagination.generate() }}
  <section class="actions">
    <a href="{{ topic|url('reply')}}">
      <span>{% trans %}Reply{% endtrans %}</span>
    </a>
    {% if is_subscribed %}
      <a href="{{ topic|url('unsubscribe')}}">
        <span>{% trans %}Unsubscribe{% endtrans %}</span>
      </a>
    {% else %}
      <a href="{{ topic|url('subscribe')}}">
        <span>{% trans %}Subscribe{% endtrans %}</span>
      </a>
    {% endif %}
    <a href="{{ topic|url('report')}}">
      <span>{% trans %}Report{% endtrans %}</span>
    </a>
  </section>
{% endblock %}
