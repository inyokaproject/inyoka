{#
    forum/edit.m.html
    ~~~~~~~~~~~~~~~

    This page shows displays a formular where the user can create either
    create a new thread or write / edit a post.

    :copyright: (c) 2007-2015 by the Inyoka Team, see AUTHORS for more details.
    :license: BSD, see LICENSE for more details.

#}
{% extends 'forum/page.m.html' %}

{% from 'forum/_forum.html' import render_article_list %}
{% if topic %}
  {% set back = topic|url %}
{% else %}
  {% set back = forum|url %}
{% endif %}

{% block content %}
  <form action="" method="post" enctype="multipart/form-data">
    {{ csrf_token() }}
    {%- if topic %}
      <h2><a href="{{ topic|url }}">{{ topic.title|e }}</a></h2>
      {%- if post %}
        <h3>{% trans %}Edit post{% endtrans %}</h3>
      {%- else %}
        <h3>{% trans %}New reply{% endtrans %}</h3>
      {%- endif %}
      {%- if topic.get_version_info() and not (isfirstpost or isnewtopic) %}
        <p class="ubuntu_version">
          <small><strong>Ubuntu-Version:</strong> {{ topic.get_version_info() }}</small>
        </p>
      {%- endif %}
      {%- if discussions %}
        <div class="topic_box discussion_info">
          {%- trans count=discussions|count, article_list=render_article_list(discussions) -%}
            This topic is the discussion of the article {{ article_list }}.
          {%- pluralize -%}
            This topic is the discussion of the articles {{ article_list }}.
          {%- endtrans -%}
        </div>
      {%- endif %}
    {%- else %}
      <h2><a href="{{ forum|url }}">{{ forum.name|e }}</a></h2>
      <h3>{% trans %}New topic{% endtrans %}</h3>
    {%- endif %}
    {% if isnewtopic or isfirstpost %}
      <div>
        <strong>{% trans %}Title:{% endtrans %}</strong>
        {{ form.title }}{{ form.errors.title }}
        <p class="version_chooser">
          {{ form.ubuntu_distro }}{{ form.errors.ubuntu_distro }}
          {{ form.ubuntu_version }}{{ form.errors.ubuntu_version }}
          <span id="version_info"></span>
        </p>
      </div>
    {% endif %}
    <div>
      <textarea id="id_text" rows="10" name="text">
        {%- if form.data.text -%}
          {{ form.data.text|e }}
        {%- elif form.initial.text != none -%}
          {{ form.initial.text|e }}
        {%- endif -%}
      </textarea>
    </div>
    {{ form.errors.__all__ }}
    <div class="actions">
      <input type="submit" value="{% trans %}Preview{% endtrans %}" name="preview" />
      <input type="submit" value="{% trans %}Publish{% endtrans %}" name="send" />
      <input type="submit" value="{% trans %}Cancel{% endtrans %}" name="cancel" />
    </div>
  </form>
  {% if preview %}
    <div class="preview_wrapper">
      <h2 class="title">{% trans %}Preview{% endtrans %}</h2>
      <div class="preview">{{ preview }}</div>
    </div>
  {% endif %}
{% endblock %}
