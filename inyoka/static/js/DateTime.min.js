(function(){var l=["Januar","Februar","M\u00e4rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],m=["S","M","D","M","D","F","S"];DateTimeField=Class.$extend({__init__:function(b,c,a,e){var d=this;this.input=$(b).click(function(){$("table.datetime").each(function(){d.container[0]!==this?$(this).hide():d.show()});return false});this.auto_show=c||false;this.only_date=a||false;this.only_time=e||false;this.readDateTime();this.container=$('<table class="datetime"></table>').click(function(){return false});
c?this.container.hide().addClass("auto_show"):this.input.hide();b=$("<tr></tr>").appendTo(this.container);this.calendar=$("<td></td>").appendTo(b);this.timetable=$("<td></td>").appendTo(b);this.drawDate(this.currentYear,this.currentMonth);this.drawTimetable();if(a){this.timetable.hide();this.currentTime="00:00:00"}e&&this.calendar.hide();this.input.after(this.container)},show:function(){this.readDateTime();this.container.css({position:"absolute",left:this.input.offset().left}).show();if(this.only_date){this.timetable.hide();
this.currentTime="00:00:00"}this.only_time&&this.calendar.hide()},readDateTime:function(){var b=this,c=function(d,f,g,j){b.currentYear=parseInt(d,10);b.currentMonth=parseInt(f,10);b.currentDay=parseInt(g,10);b.currentTime=j},a=this.input.val(),e=/(\d{4})-(\d{1,2})-(\d{1,2}) (\d{2}):(\d{2}):(\d{2})/.exec(a);if(a==""||!e){a=new Date;c(a.getFullYear(),a.getMonth()+1,a.getDate(),[a.getHours(),a.getMinutes(),a.getSeconds()].join(":"))}else c(RegExp.$1,RegExp.$2,RegExp.$3,[RegExp.$4,RegExp.$5,RegExp.$6].join(":"))},
writeDateTime:function(){this.input.val(this.currentYear+"-"+this.currentMonth+"-"+this.currentDay);this.only_date||this.input.val(this.input.val()+" "+this.currentTime);this.only_time&&this.input.val(this.currentTime)},drawTimetable:function(){var b=this,c=$('<table class="timetable"></table>').append($('<tr><th class="caption">Uhrzeit</th></tr>'));this.timetable.append(c);var a=new Date;a=[["Jetzt",[a.getHours(),a.getMinutes(),a.getSeconds()].join(":"),function(e){e.container.hide()}],["Mitternacht",
"00:00:00"],["6 Uhr","06:00:00"],["Mittag","12:00:00"],["18 Uhr","18:00:00"]];$.each(a,function(e,d){c.append($("<tr></tr>").append($("<td></td>").append($("<a/>").text(d[0]).click(function(){b.currentTime=d[1];b.writeDateTime();d.length>2&&d[2](b);return false}))))});a=$("<td></td>").appendTo($("<tr></tr>").appendTo(c));this.auto_show&&$('<a class="close">Schlie\u00dfen</a>').click(function(){b.container.hide();return false}).appendTo(a)},drawCalendar:function(){var b=this,c=parseInt(this.calendarMonth,
10),a=parseInt(this.calendarYear,10);this.calendar.children().remove();var e=$('<table class="calendar"></table>').append($("<tr></tr>").append($('<th colspan="7" class="caption"></th>').append($('<a class="calendarnav-next"></a>').text(">").click(function(){b.drawNextMonth();return false}),$('<a class="calendarnav-previous"></a>').text("<").click(function(){b.drawPreviousMonth();return false}),$("<span>"+l[c-1]+" "+a+"</span>").click(function(){$(this).hide().after($('<input type="text" />').val(c+
"-"+a).change(function(){/(\d{1,2})-(\d{1,2})-(\d+)/.exec($(this).val());if(RegExp.$1)b.drawDate(RegExp.$3,RegExp.$2,RegExp.$1);else{/(\d{1,2})-(\d+)/.exec($(this).val());RegExp.$1&&b.drawDate(RegExp.$2,RegExp.$1)}}).keypress(function(k){if(k.keyCode==13){$(this).change();return false}}).blur(function(){$(this).change()}));$(this).next().focus()}).attr("title","Klicke hier, um schnell einen anderen Monat auszuw\u00e4hlen")))),d=$("<tbody></tbody>").appendTo(e),f=$("<tr></tr>").appendTo(d);$.each(m,
function(k,n){f.append($('<th class="weekday"></th>').text(n))});var g=(new Date(a,c-1,1)).getDay(),j=$.inArray(c,[1,3,5,7,8,10,12])!=-1?31:$.inArray(c,[4,6,9,11])!=-1?30:c==2&&(a%4===0&&a%100!==0||a%400===0)?29:28;f=$("<tr></tr>").appendTo(d);for(var h=0;h<g;h++)$('<td style="background-color: #f3f3f3;"></td>').appendTo(f);var i=1,o=function(){$(".selected",$(this).parent().parent().parent()).removeClass("selected");$(this).parent().addClass("selected");b.currentDay=$(this).text();b.currentMonth=
c;b.currentYear=a;b.writeDateTime();return false};for(h=g;i<=j;h++){if(h%7===0&&i!=1)f=$("<tr></tr>").appendTo(d);g=$("<td></td>").append($("<a></a>").text(i).click(o)).appendTo(f);a==this.currentYear&&c==this.currentMonth&&i==this.currentDay&&g.addClass("selected");i++}for(;f.children().length<7;)f.append($('<td class="nonday"></td>'));this.calendar.append(e)},drawDate:function(b,c,a){a=parseInt(a,10);c=parseInt(c,10);b=parseInt(b,10);if(c>0&&c<13){this.calendarMonth=c;this.calendarYear=b;if(a){this.currentDay=
a;this.currentMonth=c;this.currentYear=b}this.drawCalendar()}},drawPreviousMonth:function(){if(this.calendarMonth==1){this.calendarMonth=12;this.calendarYear--}else this.calendarMonth--;this.drawCalendar()},drawNextMonth:function(){if(this.calendarMonth==12){this.calendarMonth=1;this.calendarYear++}else this.calendarMonth++;this.drawCalendar()},drawPreviousYear:function(){this.calendarYear--;this.drawCalendar()},drawNextYear:function(){this.calendarYear++;this.drawCalendar()},destroy:function(){this.writeDateTime();
this.container.remove();this.input.show()}});$(document).ready(function(){$("input").each(function(){var b=this.getAttribute("valuetype");if(b=="datetime")DateTimeField(this,true);else if(b=="date")DateTimeField(this,true,true);else b=="time"&&DateTimeField(this,true,false,true)})});$(document).click(function(){$("table.datetime.auto_show").hide()})})();
