(function(c){c.token_field=function(j,a){function h(e){e=e.split(a.splitToken);for(token in e)if(e[token].replace(/^\s+|\s+$/g,"")!=""){$token=c(g(e[token]));d.push(e[token]);k.push($token);$token.insertBefore(b)}}function g(e){var i=c("<span class="+a.tokenClass+">"+e+"</span>");i.append(c('<span class="tf_tok_delete">&nbsp;&nbsp;&nbsp;</span>').click(function(){delindex=d.indexOf(i.text().replace(/^\s+|\s+$/g,""));d.splice(delindex,1);k.splice(delindex,1);i.remove();f.val(d.join(a.splitToken))}));
return i}var b=c(j),f=c('<input type="hidden"></input>'),d=[],k=[];f.attr("name",b.attr("name"));h(b.val());f.val(b.val());b.val("");b.removeAttr("name");b.addClass(a.searchInputClass);f.insertAfter(b);this.handleItemSelect=function(){h(b.val());b.val("");f.val(d.join(a.splitToken))};this.handleBlur=function(){if(b.val()!=""){h(b.val());b.val("");f.val(d.join(a.splitToken))}};this.handleDelete=function(){if(d.length>0){d.pop();k.pop().remove();f.val(d.join(a.splitToken))}}};c.fn.token_field=function(j,
a,h){a=a||{};a.splitToken=a.splitToken||";";a.tokenClass=a.tokenClass||"tf_token";this.each(function(){var g=new c.token_field(this,a);a.onItemSelect=function(){g.handleItemSelect()};a.onDelete=function(){g.handleDelete()};a.onBlur=function(){setTimeout(function(){g.handleBlur()},100)};a.onSplitToken=function(){g.handleBlur()};c(this).autocomplete(j,a,h)})}})(jQuery);
