(function(h){h.autocomplete=function(j,a){function q(){k={};k.data={};k.length=0}function D(){if(s==46||s>8&&s<32)return n.hide();var b=i.val();if(b!=t){t=b;if(b.length>=a.minChars){i.addClass(a.loadingClass);L(b)}else{i.removeClass(a.loadingClass);n.hide()}}}function E(b){var c=h("li",o);if(c){p+=b;if(p<0)p=0;else if(p>=c.size())p=c.size()-1;c.removeClass("ac_over");h(c[p]).addClass("ac_over")}}function M(){var b=h("li.ac_over",o)[0];if(!b){var c=h("li",o);if(a.selectOnly){if(c.length==1)b=c[0]}else if(a.selectFirst)b=
c[0]}if(b){b=b;if(!b){b=document.createElement("li");b.extra=[];b.selectValue=""}b=h.trim(b.selectValue?b.selectValue:b.innerHTML);i.val(b);j=i[0];j.selectionStart=j.selectionEnd=j.textLength;i.focus();return true}else return false}function N(){var b=h("li.ac_over",o)[0];if(!b){var c=h("li",o);if(a.selectOnly){if(c.length==1)b=c[0]}else if(a.selectFirst)b=c[0]}if(b){z(b);return true}else return false}function z(b){if(!b){b=document.createElement("li");b.extra=[];b.selectValue=""}var c=h.trim(b.selectValue?
b.selectValue:b.innerHTML);t=j.lastSelected=c;n.html("");i.val(c);u();a.onItemSelect&&setTimeout(function(){a.onItemSelect(b)},1);i.focus()}function u(){m&&clearTimeout(m);i.removeClass(a.loadingClass);n.is(":visible")&&n.hide();a.mustMatch&&i.val()!=j.lastSelected&&z(null)}function F(b,c){if(c){i.removeClass(a.loadingClass);o.innerHTML="";if(!A||c.length==0)return u();h.browser.msie&&n.append(document.createElement("iframe"));o.appendChild(O(c));if(a.autoFill&&i.val().toLowerCase()==b.toLowerCase()){var d=
c[0][0];if(s!=8){i.val(i.val()+d.substring(t.length));var e=t.length;d=d.length;var g=i.get(0);if(g.createTextRange){var f=g.createTextRange();f.collapse(true);f.moveStart("character",e);f.moveEnd("character",d);f.select()}else if(g.setSelectionRange)g.setSelectionRange(e,d);else if(g.selectionStart){g.selectionStart=e;g.selectionEnd=d}g.focus()}}e=j;d=e.offsetLeft||0;for(g=e.offsetTop||0;e=e.offsetParent;){d+=e.offsetLeft;g+=e.offsetTop}e={x:d,y:g};d=a.width>0?a.width:i.width();n.css({width:parseInt(d,
10)+"px",top:e.y+j.offsetHeight+"px",left:e.x+"px"}).show()}else u()}function G(b){if(!b)return null;for(var c=0,d=b.length;c!=d;++c)b[c]instanceof Array||(b[c]=[b[c]]);return b}function O(b){var c=document.createElement("ul"),d=b.length;if(a.maxItemsToShow>0&&a.maxItemsToShow<d)d=a.maxItemsToShow;for(var e=0;e<d;e++){var g=b[e];if(g){var f=document.createElement("li");f.innerHTML=a.formatItem?a.formatItem(g,e,d):g[0];f.selectValue=g[0];var l=null;if(g.length>1){l=[];for(var r=1;r<g.length;r++)l[l.length]=
g[r]}f.extra=l;c.appendChild(f);h(f).hover(function(){h("li",c).removeClass("ac_over");h(this).addClass("ac_over");p=h("li",c).indexOf(h(this).get(0))},function(){h(this).removeClass("ac_over")}).click(function(H){H.preventDefault();H.stopPropagation();z(this)})}}return c}function L(b){a.matchCase||(b=b.toLowerCase());var c=a.cacheLength?I(b):null;if(c!=null&&c.length>=a.limit)F(b,c);else typeof a.url=="string"&&a.url.length>0?h.getJSON(J(b),function(d){d=G(d);B(b,d);F(b,d)}):i.removeClass(a.loadingClass)}
function J(b){b=a.url+(a.url.indexOf("?")<0?"?":"&")+"q="+encodeURI(b);for(var c in a.extraParams)b+="&"+c+"="+encodeURI(a.extraParams[c]);return b}function I(b){if(!b)return null;if(k.data[b])return k.data[b];if(a.matchSubset)for(var c=b.length-1;c>=a.minChars;c--){var d=b.substr(0,c);if(d=k.data[d]){c=[];for(var e=0;e<d.length;e++){var g=d[e],f;f=g[0];var l=b;a.matchCase||(f=f.toLowerCase());f=f.indexOf(l);f=f==-1?false:f==0||a.matchContains;if(f)c[c.length]=g}return c}}return null}function C(b,
c){c&&i.removeClass(a.loadingClass);for(var d=c?c.length:0,e=null,g=0;g<d;g++){var f=c[g];if(f[0].toLowerCase()==b.toLowerCase()){e=document.createElement("li");e.innerHTML=a.formatItem?a.formatItem(f,g,d):f[0];e.selectValue=f[0];var l=null;if(f.length>1){l=[];for(var r=1;r<f.length;r++)l[l.length]=f[r]}e.extra=l}}a.onFindValue&&setTimeout(function(){a.onFindValue(e)},1)}function B(b,c){if(!(!c||!b||!a.cacheLength)){if(!k.length||k.length>a.cacheLength){q();k.length++}else k[b]||k.length++;k.data[b]=
c}}var i=h(j).attr("autocomplete","off");a.inputClass&&i.addClass(a.inputClass);var o=document.createElement("div"),n=h(o);n.hide().addClass(a.resultsClass).css("position","absolute");a.width>0&&n.css("width",a.width);h("body").append(o);j.autocompleter=this;var m=null,t="",p=-1,k={},A=false,s=null;q();if(a.data!=null){var x="",v={},y=[];if(typeof a.url!="string")a.cacheLength=1;for(var w=0;w<a.data.length;w++){y=typeof a.data[w]=="string"?[a.data[w]]:a.data[w];if(y[0].length>0){x=y[0].substring(0,
1).toLowerCase();v[x]||(v[x]=[]);v[x].push(y)}}for(var K in v){a.cacheLength++;B(K,v[K])}}i.keydown(function(b){s=b.keyCode;switch(b.keyCode){case 8:a.onDelete&&i.val()==""&&a.onDelete();break;case 38:b.preventDefault();E(-1);break;case 40:b.preventDefault();E(1);break;case 9:if(M()){b.preventDefault();p=-1;m&&clearTimeout(m);s=null;D()}break;case 13:N()&&b.preventDefault();break;default:p=-1;m&&clearTimeout(m);m=setTimeout(function(){D()},a.delay);break}}).keypress(function(b){if((b.charCode||b.keyCode)==
a.splitTokenKey&&a.onSplitToken){b.preventDefault();a.onSplitToken()}}).focus(function(){A=true}).blur(function(){A=false;m&&clearTimeout(m);m=setTimeout(u,200);a.onBlur&&a.onBlur()});u();this.flushCache=function(){q()};this.setExtraParams=function(b){a.extraParams=b};this.findValue=function(){var b=i.val();a.matchCase||(b=b.toLowerCase());var c=a.cacheLength?I(b):null;if(c)C(b,c);else typeof a.url=="string"&&a.url.length>0?h.getJSON(J(b),function(d){d=G(d);B(b,d);C(b,d)}):C(b,null)}};h.fn.autocomplete=
function(j,a,q){a=a||{};a.url=j;a.data=typeof q=="object"&&q.constructor==Array?q:null;a.inputClass=a.inputClass||"ac_input";a.resultsClass=a.resultsClass||"ac_results";a.minChars=a.minChars||1;a.delay=a.delay||50;a.matchCase=a.matchCase||false;a.matchSubset=a.matchSubset||true;a.matchContains=a.matchContains||false;a.cacheLength=a.cacheLength||1;a.mustMatch=a.mustMatch||0;a.extraParams=a.extraParams||{};a.loadingClass=a.loadingClass||"ac_loading";a.selectFirst=a.selectFirst||true;a.selectOnly=a.selectOnly||
false;a.maxItemsToShow=a.maxItemsToShow||-1;a.limit=a.limit||-1;a.autoFill=a.autoFill||true;a.width=parseInt(a.width,10)||0;a.splitTokenKey=a.splitToken?a.splitToken.charCodeAt(0):-1;this.each(function(){new h.autocomplete(this,a)});return this};h.fn.autocompleteArray=function(j,a){return this.autocomplete(null,a,j)};h.fn.indexOf=function(j){for(var a=0;a<this.length;a++)if(this[a]==j)return a;return-1}})(jQuery);
