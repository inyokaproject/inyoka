{#
    wiki/action_edit.html
    ~~~~~~~~~~~~~~~~~~~~~

    This template is used if a user edits a page.

    :copyright: (c) 2007-2013 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}


{%- extends 'wiki/page.html' %}
{% set title = page.title if page else title %}
{% do BREADCRUMB.append(_('Edit'), page|url('edit') if page else href('wiki', title, action='edit'), True) %}
{% set scripts = ['WikiEditor'] %}
{% set styles = ['editor-sprite'] %}
{% set action = 'edit' %}
{% block wiki_content %}
  <form enctype="multipart/form-data" action="?action=edit" method="post">
    {{ csrf_token() }}
    <p>
      {# TODO: More i18n integration for page names :-/ #}
      {%- trans license_link=href('wiki', 'Wiki/Lizenz'),
               reference_link=href('wiki', 'Wiki/Referenz'),
               syntax_link=href('wiki', 'Wiki/Syntax') -%}
        By clicking on “submit“ you agree our <a href="{{ license_link }}">license</a>. If you disagree, click “cancel“ to revert all changes immediately. You'll find help at <a href="{{ reference_link }}">Wiki/Referenz</a> and <a href="{{ syntax_link }}">Wiki/Syntax</a>.
      {%- endtrans -%}
    </p>
    <div class="editor">{{ form.text }}</div>
    {{ form.errors.text }}
    {%- if storage['license_note_rendered'] %}
      <div class="license_note">{{ storage['license_note_rendered'] }}</div>
    {%- endif %}
    <div class="actions">
      {% trans %}Edit summary:{% endtrans %} {{ form.note }}
      <input type="hidden" name="edit_time" value="{{ edit_time }}" />
      <input type="hidden" name="rev" value="{{ rev }}" />
      <input type="submit" name="preview" value="{% trans %}Preview{% endtrans %}" />
      <input type="submit" value="{% trans %}Submit{% endtrans %}" />
      <input type="submit" name="cancel" value="{% trans %}Cancel{% endtrans %}" />
    </div>
    {{ form.errors.note }}
  </form>
  {%- if preview %}
    <h2>{% trans %}Preview{% endtrans %}</h2>
    <div class="preview">{{ preview }}</div>
  {%- endif %}
{% endblock %}

{% block additional_scripts %}
  {{ super() }}
  <script type="text/javascript">
    /*<![CDATA[*/
      $('textarea[name="text"]').wikiEditor({profile: 'wiki'});
      $('textarea[name="text"]')[0].inyokaWikiEditor.initPreview();
    /*]]>*/
  </script>
{% endblock %}
