{#
    wiki/page.html
    ~~~~~~~~~~~~~~

    This is the base layout for all wiki detail pages except of partial
    templates (prefixed with an underscore)

    :copyright: (c) 2007-2015 by the Inyoka Team, see AUTHORS for more details.
    :license: BSD, see LICENSE for more details.
#}
{%- extends 'overall.html' %}

{%- if page %}
  {% set breadcrumbs = [] %}
  {% for part in page.title.split('/') %}
    {% if loop.first %}
      {% set link = href('wiki', part) %}
    {% else %}
      {% set link = link + '/' + part %}
    {% endif %}
    {% do breadcrumbs.append((part, link)) %}
  {% endfor %}
  {% for breadcrumb in breadcrumbs[::-1] %}
    {% do BREADCRUMB.append(breadcrumb[0], breadcrumb[1], True) %}
  {% endfor %}
{%- endif %}
{% do BREADCRUMB.append(_('Wiki'), href('wiki'), True) %}
{% set styles = styles|default([]) + ['wiki', 'highlight'] %}
{% set active_app = 'wiki' %}
{% set navi_type  = 'tabbar' %}

{% block pathbar_extensions %}
  <div class="dropdown">
    <ul class="dropdown">
      <li><a href="{{ href('portal', 'search') }}">{% trans %}Advanced search{% endtrans %}</a></li>
      <li>
        <ul>
          <li><a href="{{ href('wiki', 'Wiki', 'Letzte Ã„nderungen') }}">{% trans %}Recent changes{% endtrans %}</a></li>
          <li><a href="{{ href('wiki', 'Wiki', 'Tags') }}">{% trans %}Tags{% endtrans %}</a></li>
        </ul>
      </li>
    </ul>
  </div>
{% endblock %}

{% block tabbar %}
  {%- if can and can.read %}
    <ul>
      {%- for action_, title in (
        ('show', _('Article')),
        ('edit', _('Edit')),
        ('log', _('Log')),
        ('backlinks', _('Backlinks')),
        ('manage', _('More'))
      ) %}
        {%- if action_ != 'edit' or (action_ == 'edit' and (can.edit or USER.is_anonymous)) %}
        <li><a href="{{ page|url(action_) }}"{% if action == action_ %} class="active"{% endif %}>{{ title }}</a></li>
        {%- endif %}
      {%- endfor %}
      <li{% if not page.topic %} class="disabled"{% endif %}>
        <a href="{{ page.topic and page.topic|url('last_post') or href('forum', 'new_discussion', page.title) }}">{% trans %}Discussion{% endtrans %}</a>
      </li>
      {%- if is_subscribed %}
        <li><a href="{{ page|url('unsubscribe') }}">{% trans %}Unsubscribe{% endtrans %}</a></li>
      {%- else %}
        <li><a href="{{ page|url('subscribe') }}">{% trans %}Subscribe{% endtrans %}</a></li>
      {%- endif %}
    </ul>
  {%- endif %}
{% endblock %}

{% block content %}
  {%- block wiki_content %}

  {%- endblock %}
{%- endblock %}
