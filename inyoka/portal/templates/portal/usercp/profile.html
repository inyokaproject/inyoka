{#
    portal/usercp/settings.html
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~

    This page shows the user control panel settings page.

    :copyright: (c) 2007-2015 by the Inyoka Team, see AUTHORS for more details.
    :license: BSD, see LICENSE for more details.
#}

{%- extends 'portal/usercp/overall.html' %}
{% from 'macros.html' import render_form %}
{% do BREADCRUMB.append(_('Profile'), href('portal', 'usercp', 'profile'), True) %}
{% set scripts = ['WikiEditor'] %}
{% set styles = ['editor-sprite'] %}
{% set selected = 'profile' %}

{% block portal_content %}
  <form enctype="multipart/form-data" class="usercp_form" method="post" action="">
    {{ csrf_token() }}
    <h3>{% trans %}Avatar settings{% endtrans %}</h3>
    <dl>
      <dt>{{ form.avatar.label_tag() }}:</dt>
      <dd><img class="usercp_avatar" src="{% if user.avatar %}{{ user.avatar.url }}{% else %}{{ href('static', 'img', 'portal', 'no_avatar.png') }}{% endif %}" alt="Avatar" /></dd>
      <dd>{{ form.avatar }}</dd>
      {%- if max_avatar_height >= 0 and max_avatar_width >= 0 %}
      <dd class="note">
        {%- trans width=max_avatar_width, height=max_avatar_height,
                 size=max_avatar_size -%}
          Please note that the maximum size for the avatar is {{ width }}x{{ height }} pixels and {{ size }} KiB. Everything that exceeds this limit will automatically be resized.
        {%- endtrans -%}
      </dd>
      {%- endif %}
      {%- if form.errors.avatar %}<dd>{{ form.errors.avatar }}</dd>{% endif %}
      <hr style="clear: both;" />
      <dt>{% trans %}Gravatar:{% endtrans %}</dt>
      {% if user.settings.use_gravatar %}
      <dd><img class="usercp_avatar" src="{{ user.gravatar_url }}" alt="Gravatar" /></dd>
      {% endif %}
      <dd>{{ form.use_gravatar }} <label for="id_use_gravatar">{{ form.use_gravatar.label }}</label>
        <dd class="note">{{ form.use_gravatar.help_text|safe }}</dd>
      </dd>
      <br style="clear: both;" />
    </dl>
    <h3>{% trans %}Contact addresses{% endtrans %}</h3>
    <dl>
      <dd>
        <p class="note">{% trans -%}
          By default, the email and jabber addresses are not displayed in your public profile. To publish them, you need to check the “show in profile” box.
        {%- endtrans %}</p>
      </dd>
      {% for item in ['email', 'jabber', 'icq', 'msn', 'aim', 'yim', 'skype', 'wengophone', 'sip'] %}
        <dt>
          <label for="{{ form[item].auto_id }}">{{ form[item].label_tag() }}:</label>
        </dt>
        <dd>{{ form[item] }}
          {%- if item in ['email', 'jabber'] %}
            <span class="note">{{ form['show_' + item] }}
              <label for="id_show_{{ item }}">{% trans %}Show in profile{% endtrans %}</label>
            </span>
          {%- endif -%}
        </dd>
        {%- if form.errors[item] %}<dd>{{ form.errors[item] }}</dd>{% endif %}
      {% endfor %}
    </dl>
    <h3>{% trans %}Miscellaneous settings{% endtrans %}</h3>
    {{ render_form(form, ['occupation', 'interests', 'website',
                          'launchpad', 'gpgkey']) }}
    <h4>{% trans %}Geographical location{% endtrans %}</h4>
    {{ render_form(form, ['location', 'coordinates']) }}
    <h3>{% trans %}OpenIDs{% endtrans %}</h3>
    <p>
      {% if openids %}
        {% trans %}Selected OpenIDs will be removed!{% endtrans %}
      {% else %}
        {% trans %}No OpenID is associated with your account.{% endtrans %}
      {% endif %}
    </p>
    <p>{% trans -%}
      To associate an OpenID with your account, login with your OpenID.
    {%- endtrans %}</p>
    <ul>
      {% for openid in openids %}
        <li>
          <input type="checkbox" name="openids" value="{{ openid.id }}" />
          {{ openid.value }}
        </li>
      {% endfor %}
    </ul>
    <h3>{% trans %}Signature{% endtrans %}</h3>
    <p class="note">{% trans n=max_sig_length, link=href('wiki', 'ubuntuusers/Moderatoren/Forenregeln', _anchor='8-Signaturregeln') -%}
      The signature will be appended to every post. It cannot contain more than {{ n }} characters. Please follow the <a href="{{ link }}">signature rules</a>.
    {%- endtrans %}</p>
    <p>
      {{ form.signature }}
    </p>
    {{ form.errors.signature }}
    <p>
      <input type="submit" value="{% trans %}Submit{% endtrans %}" />
    </p>
    <p>
      <a href="{{ href('portal', 'user', user.username ) }}">{% trans %}Show my profile{% endtrans %}</a>
    </p>
  </form>
{% endblock %}

{% block additional_scripts %}
  {{ super() }}

  <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key={{ gmaps_apikey|e }}" type="text/javascript"></script>

  <script type="text/javascript">
    /*<![CDATA[*/
    var editor = new WikiEditor('textarea[name="signature"]');

    $(function() {
      $('p.note', $('#id_coordinates').parent())
        .html('Solltest du deine Koordinaten nicht kennen gibt einfach deine ' +
              'Adresse an und klicke auf <a href="javascript:findCoords()">' +
              'Koordinaten suchen</a>.');
    });
    function findCoords() {
      var geocoder = new GClientGeocoder();
      if ($('#id_coordinates').val()) {
        var location = $('#id_coordinates').val();
      } else {
        var location = $('#id_location').val();
      }

      $('#id_coordinates').val('suche nach Koordinaten...');

      if (!location) {
        alert('Du hast keinen Ort angegeben!');
      }

      geocoder.getLatLng(location, function(p) {
        $('#id_coordinates').val(p ? p.lat() + ', ' + p.lng() : '');
      });
    }

    /*]]>*/
  </script>
{% endblock %}
