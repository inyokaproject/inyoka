{#
    portal/lost_password
    ~~~~~~~~~~~~~~~~~~~~

    This page displays a formular where the user can create a new password
    if he lost the old one.

    :copyright: (c) 2007-2012 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}

{%- extends 'portal/overall.html' %}
{% from 'macros.html' import render_form %}
{% do BREADCRUMB.append(_('Lost password'), href('portal', 'lost_password'), True) %}
{% block portal_content %}
  <h3>{{ _('Lost password') }}</h3>
  <p>
    {{ _('You have forgotten your password? You can obtain a new one here.') }}
  </p>
  {% if form.errors.__all__ %}{{ form.errors.__all__ }}{% endif %}
  <form action="" method="post">
		{{ csrf_token() }}
    <p class="hide"><input type="submit" value="Registrieren" /></p>
    {# enter -> first submit field #}
    {{ render_form(form, ['username', 'email', 'captcha']) }}
    <p>
      <input type="submit" value="{{ _('Request new password') }}" />
    </p>

  </form>
{% endblock %}

{% block additional_scripts %}
  {{ super() }}
  <script type="text/javascript">
    /*<![CDATA[*/
    (function() {
      var captcha_url = $('img.captcha').attr('src');
      $('input[name="renew_captcha"]')
        .click(function() {
          var uid = Math.random().toString().substring(2, 10);
          $('img.captcha')
            .attr('src', captcha_url + '&rnd=' + uid);
          return false;
        });
      $('#id_username').focus();
    })();
    /*]]>*/
  </script>
{% endblock %}
