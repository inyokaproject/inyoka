{#
    portal/user_edit_privileges.html
    ~~~~~~~~~~~~~~~~~~~~

    Manage the privileges of a user.

    :copyright: (c) 2007-2011 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'portal/user_admin.html' %}

{% do BREADCRUMB.append(_('Privileges'), href('portal', 'user', user.urlsafe_username, 'edit', 'privileges'), True) %}
{% do BREADCRUMB.append(_('Edit'), href('portal', 'user', user.urlsafe_username, 'edit'), True) %}
{% do BREADCRUMB.append(user.username, user|url, True) %}
{% do BREADCRUMB.append(_('Members'), href('portal', 'users')) %}

{% macro render_grouplist(derived) %}
  {% for group in derived %}<a href="{{ group|url }}">{{ group.name|e }}</a>{% if not loop.last %}, {% endif %}{% endfor %}
{%- endmacro %}

{% block content %}
  {{ super() }}
  <form enctype="multipart/form-data" id="user_edit_form" method="post" action="">
    <h3>{% trans %}Privileges{% endtrans %}</h3>
      {%- for id, name, checked, derived in permissions %}
        <input type="checkbox" name="permissions" value="{{ id }}" id="perm_{{ id }}"
               {%- if checked %} checked="checked"{% endif %} />
        <label for="perm_{{ id }}">{{ name|e }}</label>
        {%- if derived %}
          <span class="note">{% trans grouplist=render_grouplist(derived) -%}
            (Derived from {{ grouplist }})
          {%- endtrans %}</span>
        {%- endif -%}
        <br />
      {%- endfor %}
      {{ form.permissions.errors }}
    <h3>{% trans %}Forum privileges{% endtrans %}</h3>
    <div id="forum_rights">{% trans %}Sorry, you need to enable javascript to edit forum privileges.{% endtrans %}</div>
    <p><input type="submit" value="{% trans %}Submit{% endtrans %}" /></p>
  </form>
{% endblock %}

{% block additional_scripts %}
  {{ super() }}
  <script type="text/javascript">
    /* <![CDATA[ */
    var forum_rights = new PrivilegeBox('#forum_rights', {{ user_forum_privileges|jsonencode }},
      {{ forum_privileges|jsonencode }});
    /* ]]> */
  </script>
{% endblock %}
