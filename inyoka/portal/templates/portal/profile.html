{#
    portal/profile.html
    ~~~~~~~~~~~~~~~~~~~

    This page shows a user's profile.

    :copyright: (c) 2007-2012 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'portal/overall.html' %}

{% do BREADCRUMB.append(user.username, user|url, True) %}
{% do BREADCRUMB.append(_('Members'), href('portal', 'users')) %}
{% set styles = ['portal', 'highlight'] %}

{% macro show_item(item) %}
  {%- if user[item] and user.settings['show_'+item] -%}
    <td>{{ user[item]|e }}</td>
  {%- elif user[item] and REQUEST.user.can('user_edit') -%}
    <td class="hidden">{{ user[item]|e }}</td>
  {%- else -%}
    <td>–</td>
  {%- endif -%}
{% endmacro %}

{% macro generate_subscription_link(do='subscribe') %}
  {{ href('portal', 'user', user.username, do)|e }}
{% endmacro %}

{% block tabbar %}
  <ul>
    <li>
      <a href="{{ user|url }}"{% if not category %}class="active"{% endif %}>
        General
      </a>
    </li>
    {% for cat in categories %}
      <li>
        <a href="{{ user|url(category=cat) }}"{% if cat == category %}class="active"{% endif %}>
          {{ cat.title|e }}
        </a>
      </li>
    {% endfor %}
    {% if wikipage %}
      <li>
        <a href="{{ href('wiki', 'Benutzer', user.username|e) }}">
          {% trans %}Wikipage{% endtrans %}
        </a>
      </li>
    {% endif %}
    {%- if request.user.can('user_edit') %}
      <li>
        <a href="{{ href('portal', 'user', user.username, 'edit') }}"
           class="admin_link">
          {% trans %}Edit{% endtrans %}
        </a>
      </li>
    {%- endif %}
    {%- if request.user.can('subscribe_to_users') -%}
      <li>
        {%- if is_subscribed %}
          <a href="{{ generate_subscription_link(do='unsubscribe') }}"
             class="action action_subscribe subscribe_user admin_link">
            {% trans %}Don’t watch anymore{% endtrans %}
          </a>
        {%- else %}
          <a href="{{ generate_subscription_link() }}"
             class="action action_subscribe subscribe_user admin_link">
            {% trans %}Watch{% endtrans %}
          </a>
        {%- endif -%}
      </li>
    {%- endif %}
  </ul>
{% endblock %}

{% block portal_content %}
  <h3>{{ user.username|e }}</h3>
  {%- if user in (User.objects.get_system_user(), User.objects.get_anonymous_user()) %}
    {% trans name=user.username|e %}{{ name }} is a system user.{% endtrans %}
  {%- elif user.is_deleted or user.is_banned %}
    {% trans name=user.username|e %}{{ name }} is not available.{% endtrans %}
  {%- else %}
    <!--
    <table class="userinfo admin_link_hover">
      <tr>
        <th>{% trans %}Name{% endtrans %}</th>
        <td>{{ user.username|e }}</td>
        <td rowspan="6">
          <img class="userinfo_avatar" src="{{ user.avatar_url|e }}"
               alt="{% trans user=user.username|e %}Avatar of {{ user }}{% endtrans %}" />
        </td>
      </tr>
      <tr>
        <th>{% trans %}Email address{% endtrans %}</th>
        {{ show_item('email') }}
      </tr>
      <tr>
        <th>{% trans %}Member since{% endtrans %}</th>
        <td>{{ user.date_joined|datetimeformat }}</td>
      </tr>
      <tr>
        <th>{% trans %}Posts{% endtrans %}</th>
        <td>
          {{ user.post_count }}
          (<a href="{{ href('forum', 'author', user.username) }}">{% trans %}show{% endtrans %}</a>)
        </td>
      </tr>
      <tr>
        <th colspan="3">{% trans %}Group memberships{% endtrans %}
          {% if REQUEST.user.can('user_edit') %}
          <a href="{{ href('portal', 'user', user.username, 'edit', 'groups') }}" class="admin_link"><img src="{{ href('static', 'img/ikhaya/category_edit.png') }}"></a>
          {% endif %}
        </th>
      </tr>
      <tr>
        <td colspan="3">
          {%- for group in groups -%}
            <a href="{{ group|url }}"{% if not group.is_public %} class="hidden"{% endif %}>{{ group.name|e }}</a>
            {%- if not loop.last %}, {% endif %}
          {%- else %}{% trans name=user.username|e -%}
            “{{ name }}“ is no member of any group.
           {%- endtrans %}
          {%- endfor %}
        </td>
      </tr>
    </table>
    -->
    <div class="userprofile_fields">
      {% for data in profile_data %}
        <div class="field">
          <div class="field_left"></div>
          <div class="field_right">
            <div class="title">{{ data.profile_field.title|e }}</div>
            <p>{{ data.data|e }}</p>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
