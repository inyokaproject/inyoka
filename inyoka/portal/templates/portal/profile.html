{#
    portal/profile.html
    ~~~~~~~~~~~~~~~~~~~

    This page shows a user's profile.

    :copyright: (c) 2007-2012 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'portal/overall.html' %}

{% do BREADCRUMB.append(user.username, user|url, True) %}
{% do BREADCRUMB.append(_('Members'), href('portal', 'users')) %}
{% set styles = ['portal', 'highlight'] %}
{% set navi_type = 'both' %}

{% macro show_item(item) %}
  {%- if user[item] and user.settings['show_'+item] -%}
    <td>{{ user[item]|e }}</td>
  {%- elif user[item] and REQUEST.user.can('user_edit') -%}
    <td class="hidden">{{ user[item]|e }}</td>
  {%- else -%}
    <td>–</td>
  {%- endif -%}
{% endmacro %}

{% macro generate_subscription_link(do='subscribe') %}
  {{ href('portal', 'user', user.username, do)|e }}
{% endmacro %}

{% block tabbar %}
  <ul>
    <li>
      <a href="{{ user|url }}" class="active">
        {% trans %}Profile{% endtrans %}
      </a>
    </li>
    {% if wikipage %}
      <li>
        <a href="{{ href('wiki', SETTINGS.WIKI_USER_BASE, user.username|e) }}">
          {% trans %}User page{% endtrans %}
        </a>
      </li>
    {% endif %}
    {%- if request.user == user %}
      <li>
        <a href="{{ href('portal', 'usercp', 'profile') }}">
          {% trans %}Edit{% endtrans %}
        </a>
      </li>
    {%- elif request.user.can('user_edit') %}
      <li>
        <a href="{{ href('portal', 'user', user.username, 'edit') }}"
           class="admin_link">
          {% trans %}Edit{% endtrans %}
        </a>
      </li>
    {%- endif %}
    {%- if request.user.can('subscribe_to_users') -%}
      <li>
        {%- if is_subscribed %}
          <a href="{{ generate_subscription_link(do='unsubscribe') }}"
             class="action action_subscribe subscribe_user admin_link">
            {% trans %}Don’t watch anymore{% endtrans %}
          </a>
        {%- else %}
          <a href="{{ generate_subscription_link() }}"
             class="action action_subscribe subscribe_user admin_link">
            {% trans %}Watch{% endtrans %}
          </a>
        {%- endif -%}
      </li>
    {%- endif %}
  </ul>
{% endblock %}

{% block portal_content %}
  <h3>{{ user.username|e }}</h3>
  {%- if user in (User.objects.get_system_user(), User.objects.get_anonymous_user()) %}
    {% trans name=user.username|e %}{{ name }} is a system user.{% endtrans %}
  {%- elif user.is_deleted or user.is_banned %}
    {% trans name=user.username|e %}{{ name }} is not available.{% endtrans %}
  {%- else %}
    <div class="userprofile">
      <div class="general"> {# left column #}
        <img class="avatar" src="{{ user.avatar_url|e }}"
             alt="{% trans user=user.username|e %}Avatar of {{ user }}{% endtrans %}" />
        <table>
          <tr>
            <th>{% trans %}Member since{% endtrans %}</th>
            <td>{{ user.date_joined|datetimeformat }}</td>
          </tr>
          <tr>
            <th>{% trans %}Posts{% endtrans %}</th>
            <td>
              {{ user.post_count }}
              (<a href="{{ href('forum', 'author', user.username) }}">{% trans %}show{% endtrans %}</a>)
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <a href="{{ user|url('privmsg') }}">{% trans %}Private message{% endtrans %}</a>
            </td>
          </tr>
          {% for data in data_uncategorized %}
            <tr>
              <th>{{ data.title|e }}</th>
              <td>{{ data.data|e }}</td>
            </tr>
          {% endfor %}
        </table>
      </div>
      <div class="fields"> {# right column #}
        {% for category in categories %}
          <table>
            <colgroup>
              <col class="field" />
              <col class="data" />
            <thead>
              <tr>
                <th colspan="2">{{ category.title }}</th>
              </tr>
            </thead>
            <tbody>
              {% for data in category.data %}
                <tr>
                  <th>{{ data.title|e }}</th>
                  <td>{{ data.data|e }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endblock %}
