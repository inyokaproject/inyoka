{#
    portal/privmsg/index.m.html
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~

    Display a list of private messages.

    :copyright: (c) 2007-2011 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{% extends 'portal/overall.m.html' %}
{% set selected = folder.id %}

{% block content %}
  {%- if not folder %}
    <a href="{{ href('portal', 'privmsg', 'inbox') }}"{{ selected == 'inbox' and ' class="active"' or '' }}>
      <div class="button">{% trans %}Inbox{% endtrans %}</div>
    </a>
    <a href="{{ href('portal', 'privmsg', 'sent') }}"{{ selected == 'sent' and ' class="active"' or '' }}>
      <div class="button">{% trans %}Sent mail{% endtrans %}</div>
    </a>
    <a href="{{ href('portal', 'privmsg', 'archive') }}"{{ selected == 'archive' and ' class="active"' or '' }}>
      <div class="button">{% trans %}Archive{% endtrans %}</div>
    </a>
    <a href="{{ href('portal', 'privmsg', 'trash') }}"{{ selected == 'trash' and ' class="active"' or '' }}>
      <div class="button">{% trans %}Trash{% endtrans %}</div>
    </a>
    <a href="{{ href('portal', 'privmsg', 'new') }}"{{ selected == 'new' and ' class="active"' or '' }}>
      <div class="button">{% trans %}Compose message{% endtrans %}</div>
    </a>
  {%- else %}
    {%- if message %}
      <a href="{{ href('portal', 'privmsg', folder.id ) }}">
        <div class="button">{% trans %}« Back{% endtrans %}</div>
      </a>
      <h3>{% trans name=message.author|e %}Message from {{ name }}{% endtrans %}</h3>
      <div class="meta">
        {{ message.pub_date|datetimeformat }} |
        {% if message.recipients|length > 1 %}
          {% trans %}To:{% endtrans %}
          {% for recipient in message.recipients %}
            <a href="{{ recipient|url }}">{{ recipient|e }}</a>
            {% if not loop.last %}, {% endif %}
          {% endfor %}
        {% endif %}
      </div>
      <div class="text">
        {{ message.rendered_text }}
      </div>
      <section class="actions">
        <a href="{{ message|url('reply') }}"><span>{% trans %}Reply{% endtrans %}</span></a>
        {% if message.recipients|length > 1 %}
          <a href="{{ message|url('reply_to_all') }}"><span>{% trans %}Reply to all{% endtrans %}</span></a>
        {% endif %}
        <a href="{{ message|url('forward') }}"><span>{% trans %}Forward{% endtrans %}</span></a>
        <a href="?action=restore"><span>{% trans %}Restore{% endtrans %}</span></a>
        <a href="?action=archive"><span>{% trans %}Archive{% endtrans %}</span></a>
        <a href="?action=delete"><span>{% trans %}Delete{% endtrans %}</span></a>
      </section>
    {%- else %}
      <a href="{{ href('portal', 'privmsg') }}">
        <div class="button">{% trans %}« Messages{% endtrans %}</div>
      </a>
      {% for entry in entries %}
        <a href="{{ entry|url }}">
          <div class="button{{ ' unread' if not entry.read }}">
            {% trans subject=entry.message.subject|e, author=entry.message.author|e %}
              {{ subject }} from {{ author }}
            {% endtrans %}
          </div>
        </a>
      {% endfor %}
    {%- endif %}
  {%- endif %}
{% endblock %}
