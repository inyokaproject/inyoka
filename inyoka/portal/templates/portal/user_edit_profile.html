{#
    portal/user_edit_profile.html
    ~~~~~~~~~~~~~~~~~~~~

    Change a userprofile

    :copyright: (c) 2007-2012 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'portal/user_admin.html' %}

{% do BREADCRUMB.append(_('Profile'), href('portal', 'user', user.urlsafe_username, 'edit', 'profile'), True) %}
{% do BREADCRUMB.append(_('Edit'), href('portal', 'user', user.urlsafe_username, 'edit'), True) %}
{% do BREADCRUMB.append(user.username, user|url, True) %}
{% do BREADCRUMB.append(_('Members'), href('portal', 'users')) %}

{% block content %}
  {{ super() }}
  <form enctype="multipart/form-data" id="user_edit_form" method="post" action="">
    {{ render_form(form, ['username'], inline=true) }}
    <dt>{% trans %}User title:{% endtrans %}</dt>
    <dd>{{ form.member_title }}
      {% if user.groups.all() %}
      <div class="group_titles">
      {% for group in user.groups.all() %}
        <input type="checkbox" name="group_titles" value="{{ group }}" /> {{ group }}
      {% endfor %}
      </div>
      {%- endif %}
    </dd>
    <h3>{% trans %}Avatar settings{% endtrans %}</h3>
    <dt>{{ form.avatar.label }}</dt>
    <dd><img class="usercp_avatar" src="{{ user.avatar_url }}" alt="Avatar" /></dd>
    <dd>{{ form.avatar }}</dd>
    <dd>{{ form.delete_avatar }} {{ form.delete_avatar.label }}</dd>
    <dd class="note">{% trans height=avatar_height, width=avatar_width -%}
      (Will be scaled to {{ width }}x{{ height }})
    {%- endtrans %}</dd>
    <h3>{% trans %}Contact addresses{% endtrans %}</h3>
    {{ render_form(form, ['email', 'jabber', 'icq', 'msn', 'aim', 'yim', 'skype', 'wengophone', 'sip']) }}
    <h3>{% trans %}Miscellaneous settings{% endtrans %}</h3>
    {{ render_form(form, ['occupation', 'interests', 'website',
                          'launchpad', 'gpgkey']) }}
    <h4>{% trans %}Geographical location{% endtrans %}</h4>
    {{ render_form(form, ['location', 'coordinates_long', 'coordinates_lat']) }}
    <h3>{% trans %}Signature{% endtrans %}</h3>
    <p>{{ form.signature }}</p>
    <h3>{% trans %}Public information{% endtrans %}</h3>
    <table id="profile_fields">
      <thead>
        <tr>
          <td class="field">{% trans %}Field{% endtrans %}</td>
          <td class="data">{% trans %}Data{% endtrans %}</td>
          <td class="delete"></td>
        </tr>
      </thead>
      <tbody>
        {% for data in profile_data %}
          <tr>
            <td>{{ data.profile_field.title }}</td>
            <td>
              <input type="text" value="{{ data.data }}"
                     name="profile_field_{{ loop.index0 }}.{{ data.profile_field.id }}" />
              </td>
            <td>
              <a class="delete">Delete</a></td>
          </tr>
        {% endfor %}
      </tbody>
      <tfoot>
        <tr>
          <td colspan="3" class="add">
            <a id="add_profile_field">Add a field</a>
          </td>
        </tr>
      </tfoot>
    </table>
    <p><input type="submit" value="{% trans %}Submit{% endtrans %}" /></p>
  </form>
{% endblock %}

{% block additional_scripts %}
  {{ super() }}

  <script type="text/javascript">
    /*<![CDATA[*/
    $('#add_profile_field').click(function() {
      $('#profile_fields tbody')
      .append($('<tr>')
        .append($('<td>')
          .append($('<select>')
          )
        )
        .append($('<td>')
          .append($('<input>')
            .attr('type', 'text')
          )
        )
        .append($('<td>')
          .append($('<a>')
            .attr('class', 'delete')
            .text('Delete')
            .click(function() {
              $(this).parent().parent().remove();
            })
          )
        )
      )

      var profile_fields = JSON.parse('{{ profile_fields }}')
      var select = $('#profile_fields tbody tr:last td select')
      select.append($('<option>'));
      for (i in profile_fields) {
        select.append($('<option>')
          .attr('value', profile_fields[i].id)
          .text(profile_fields[i].title)
        );
      }
      select.change(function() {
        var row = select.parent().parent()
        var name = 'profile_field_' + row.index() + '.' + select.val();
        row.find('input').attr('name', name);
      });
      return false;
    });
    $('.delete').click(function() {
      $(this).parent().parent().remove();
      return false;
    });
    /*]]>*/
  </script>
{% endblock %}
