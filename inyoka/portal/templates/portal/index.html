{#
    portal/index.html
    ~~~~~~~~~~~~~~~~~

    This is ubuntuusers' main page that provides links to quite many pages.

    It also displays some of the latest ikhaya messages.

    :copyright: (c) 2007-2011 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'portal/overall.html' %}
{%- do BREADCRUMB.append('Portal', href('portal'), True) -%}

{% block html_head %}
  {{ super() }}
	<script type="text/javascript" src="{{ href('static', 'js', 'processing-1.3.0.min.js') }}"></script>
	<style type="text/css">
		@font-face {
		  font-family: 'Ubuntu';
		  font-style: normal;
		  font-weight: normal;
		  src: local('Ubuntu'), url('http://themes.googleusercontent.com/static/fonts/ubuntu/v1/_xyN3apAT_yRRDeqB3sPRg.woff') format('woff');
		}
		@font-face {
		  font-family: 'UbuntuBold';
		  font-style: normal;
		  font-weight: bold;
		  src: local('Ubuntu Bold'), local('Ubuntu-Bold'), url('http://themes.googleusercontent.com/static/fonts/ubuntu/v1/0ihfXUL2emPh0ROJezvraD8E0i7KZn-EPnyo3HZu7kw.woff') format('woff');
		}
		@font-face {
		  font-family: 'UbuntuItalic';
		  font-style: normal;
		  font-weight: normal;
		  src: local('Ubuntu Italic'), local('Ubuntu-Italic'), url('http://themes.googleusercontent.com/static/fonts/ubuntu/v1/kbP_6ONYVgE-bLa9ZRbvvvesZW2xOQ-xsNqO47m55DA.woff') format('woff');
		}
	</style>
{% endblock %}
{% block pre_navigation %}
  <div class="container">
    <div>&nbsp;</div>
    <div>
	<script type="application/processing">
			
		////////////////////////////////////////////////////////	
			
		/* @pjs transparent="true"; */
		
		/* images will need to be preloaded, preferably base64 encoded */    

		var RELEASEDATE = new Date(2011, 10-1, 13);	//yyyy, mm, dd
		int COUNTDOWNSTART = 21;	//logo animates when this many days are left 
		boolean DEMO = false;	//set to FALSE to make the banner function in realtime
		
		PImage bg, logo; 
		
		var today;
		int state;
		float progress;
		
		void setup() {
			
			size(180, 150);
			frameRate(12);
			smooth();
			noStroke();

			bg = loadImage("{{ href('static', 'img', 'portal', 'countdown', 'bg.png') }}");
			logo = loadImage("{{ href('static', 'img', 'portal', 'countdown', 'logo.png') }}"); //from Ubuntu Branding assets, Canonical Design
			
			today = new Date();
			
			if (DEMO) {
				progress = 0;
				state = 1;
			} else {
				if (today < RELEASEDATE) {
					state = 1;		//1 = progress
				} else if (RELEASEDATE-today < 86400000) {
					state = 2;		//2 = throb
				} else {
					state = 3;		//3 = released
				}	
			}
		}

		void draw() {
			
			background(0, 0);
			
			switch(state) {
			case 1: //counting down
				drawProgress();
				if(DEMO) {
					if(progress<1) { progress += 0.01; }	//debug
					else { state = 2; }						//debug
				}
				break;
			case 2: //coming soon
				drawThrob();
				if(DEMO) {
					if(progress>0) { progress -= 0.01; }	//debug
					else { state = 3; }						//debug
				}
				break;
			case 3: //it's here
				drawReleased();
				if(DEMO) {
					if(progress<1) { progress += 0.01; }	//debug
					else { setup(); }						//debug
				}
				break;
			}

		}

		void drawProgress() {
			
			if(DEMO) {
				int left = (1-progress)*21;
			} else {
				left = new Date(RELEASEDATE - today).getDate();
				progress = (left <= COUNTDOWNSTART) ? 1-left/COUNTDOWNSTART : 0;
			}
			
			image(bg, 0, 0);					//bg
			
			fill(#333333);						//empty
			ellipse(121.25, 75.75, 74, 74);	
			fill(255);							//filled
			arc(121.25, 75.75, 73, 73, TWO_PI/3, TWO_PI/3+TWO_PI*progress);
			
			if(progress<0.34) {
				fill(#333333);
			} else {
				fill(255);
			}
			ellipse(95, 75.75, 12, 12);			//dot 1
			
			if(progress<0.67) {
				fill(#333333);
			} else {
				fill(255);
			}
			ellipse(134, 75.75-22, 12, 12);		//dot 2
			
			if(progress<1) {
				fill(#333333);
			} else {
				fill(255, 50);
			}
			ellipse(134, 75.75+22, 12, 12);		//dot 3
			
			image(logo, 0, 0);					//logo mask
			
			textFont(createFont('Ubuntu', 22));
			fill(#333333);
			text("11.10", 17, 57);				//test 11.10
			
			textFont(createFont('UbuntuBold', 36));
			fill(#DD4814);
			text(int(left), 17, 93);			//text days
			
			textFont(createFont('UbuntuItalic', 14));
			fill(#555753);
			d = (left == 1) ? "day left" : "days left"
			text(d, 17.5, 113);			//text days left
			
		}

		void drawThrob() {
			
			image(bg, 0, 0);					//bg
			
			fill(255); 
			ellipse(121.25, 75.75, 74, 74);
			
			fill(#dd4814);
			ellipse(95, 75.75, 12, 12);			//dot 1
			ellipse(134, 75.75-22, 12, 12);		//dot 2
			ellipse(134, 75.75+22, 12, 12);		//dot 3
			
			float f = frameCount/10;
			fill(255, 500*abs(sin(f)));
			ellipse(95, 75.75, 12, 12);			//dot 1
			fill(255, 500*abs(sin(f+TWO_PI/3)));
			ellipse(134, 75.75-22, 12, 12);		//dot 2
			fill(255, 500*abs(sin(f+TWO_PI/3*2)));
			ellipse(134, 75.75+22, 12, 12);		//dot 3
			
			image(logo, 0, 0);					//logo mask
			
			textFont(createFont('Ubuntu', 22));
			fill(#333333);	
			text("11.10", 17, 57);				//text 11.10

			textFont(createFont('UbuntuItalic', 14));
			fill(#DD4814);
			text("coming", 20, 75);				//text coming soon
			text("soon", 20, 87);
			
		}

		void drawReleased() {
			image(bg, 0, 0);					//bg
			fill(255); 
			ellipse(121.25, 75.75, 74, 74);
			image(logo, 0, 0);					//logo mask
			
			textFont(createFont('Ubuntu', 22));
			fill(#DD4814);
			text("11.10", 17, 57);				//text 11.10
			textFont(createFont('UbuntuItalic', 14));
			fill(#333333);
			text("it's here", 20, 75);			//text it's here
		}

		////////////////////////////////////////////////////////

	</script><canvas width="200" height="200"></canvas>
	<div style="display: none;"><a rel="license" href="http://creativecommons.org/licenses/by/3.0/"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by/3.0/88x31.png" /></a><br /><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Ubuntu 11.10 Oneiric Ocelot Count-down Banner</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="is.gd/sayantanchaudhuri" property="cc:attributionName" rel="cc:attributionURL">Sayantan Chaudhuri</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 Unported License</a>.</div>
    </div>
  </div>
  <div class="container get_ubuntu">
    <div>
      <h3><a href="{{ get_ubuntu_link }}">Hol dir Ubuntu!</a></h3>
      <span><a href="{{ get_ubuntu_link }}">{{ get_ubuntu_description }}</a></span>
    </div>
  </div>
  <div class="container calendar">
    <div class="calendar link">
      <h3><a href="{{ href('portal', 'calendar') }}">Kalender</a></h3>
      <span><a href="/calendar/" class="calendar_link">Nächste Veranstaltungen</a></span>
    </div>
    <div class="calendar overview">
    {% if calendar_events %}
      <ul class="events">
      {% for event in calendar_events %}
        <li>{{ event.friendly_title(with_date=false, with_html_link=true) }}</li>
      {%- endfor %}
      </ul>
    {% else %}
    <p>Keine anstehenden Veranstaltungen.</p>
    {% endif %}
    </div>    
  </div>
{% endblock %}

{% block portal_content %}
  <h3>Hallo</h3>
  <img src="{{ href('static', 'img', 'portal', 'ubuntu.png') }}" alt="Ubuntu" class="cat" />
  <p>
    Hier findest du freundliche Hilfe für Ubuntu, Kubuntu, Xubuntu und die
    anderen Ubuntu-Derivate. In unserem <a href="{{ href('forum') }}">Forum</a> beantworten
    hilfsbereite Forumsbenutzer gerne deine Fragen und im
    <a href="{{ href('wiki') }}">Wiki</a> findest du viele Anleitungen und Erklärungen.
    Falls du neu bei Ubuntu bist, findest du dort auch eine Seite für 
    <a href="{{ href('wiki', 'Einsteiger') }}">Einsteiger</a>. Außerdem existiert noch
    <a href="{{ href('ikhaya') }}">Ikhaya</a>, unser Magazin, in dem Neuigkeiten aus der
    Ubuntu- und Linuxwelt gemeldet werden. Unser <a href="{{ href('planet') }}">Planet</a>
    stellt Nachrichten der Ubuntu-Gemeinschaft zusammen. Wenn du auch unsere <a href="{{
    href('wiki', 'ubuntuusers/Moderatoren/Forenregeln') }}">Regeln</a> beachtest,
    kann nichts schiefgehen ;-)
  </p>
  {%- if ikhaya_latest %}
  {{ feed_button(href('portal', 'feeds', _anchor='ikhaya')) }}
  <h3>Neues von ubuntuusers.de</h3>
  <div class="articles">
    {%- for article in ikhaya_latest %}
    <div class="article">
      <div class="meta">
        {%- if article.pub_datetime == article.updated %}
        <a href="{{ article|url }}">{{ article.updated|datetimeformat }}</a>
        {%- else %}
        <a href="{{ article|url }}" title="Letzte Aktualisierung {{article.updated|specificdatetimeformat(true) 
           }} / Erstellt am {{ article.pub_datetime|datetimeformat }}">{{ article.updated|datetimeformat }}</a>
        {%- endif %}
        {%- if article.comments_enabled %}
          <br /><a href="{{ article|url('comments') }}" class="comments">
          {%- if article.comment_count == 0 %} Keine Kommentare
          {%- elif article.comment_count == 1 %} Ein Kommentar
          {%- else %} {{ article.comment_count|hnumber|capitalize }} Kommentare
          {%- endif %}  
          </a>
        {%- endif %}
      </div>
      <a href="{{ article|url }}">{{ article.subject|e }}</a>
      <p class="text">
        {{ article.simplified_intro|truncate(250, true)|e }}
      </p>
    </div>
    {%- endfor %}
  </div>
  {%- endif %}
  <h3>Wer ist online?</h3>
  <p>
    {% trans all=sessions.all %}
    Momentan ist <strong>{{ all }}</strong> Benutzer online,
    {% pluralize %}
    Momentan sind <strong>{{ all }}</strong> Benutzer online,
    {% endtrans %}
    davon
    {% trans registered=sessions.registered %}
    <strong>{{ registered }}</strong> Angemeldeter
    {% pluralize %}
    <strong>{{ registered }}</strong> Angemeldete
    {% endtrans %}
    und
    {% trans guests=sessions.anonymous %}
    <strong>{{ guests }}</strong> Gast.
    {% pluralize %}
    <strong>{{ guests }}</strong> Gäste.
  {% endtrans %}<br />
  Der Rekord liegt bei <strong>{{ record }}</strong> Benutzern {{ record_time|specificdatetimeformat(true) }}.
  </p>
  <p>Registrierte Benutzer:
  {% for session in sessions.registered_sessions %}
    {%- if session.link -%}
      <a href="{{ session.link|e }}" class="{{ session.type }}">{{ session.text|e }}</a>{% else %}
      <span class="{{ session.type }}">{{ session.text|e }}</span>{%- endif %}{%- if not loop.last %}, {% endif %}
  {%- else %}
    keine
  {%- endfor %}
  </p>
{% endblock %}
