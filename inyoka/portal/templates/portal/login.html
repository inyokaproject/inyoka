{#
    portal/login.html
    ~~~~~~~~~~~~~~~~~

    This page displays a formular where the user can log in.

    :copyright: (c) 2007-2012 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}

{%- extends 'portal/overall.html' %}
{% from 'macros.html' import render_form %}
{% do BREADCRUMB.append(_('Login'), href('portal', 'login'), True) %}
{% block portal_content %}
  <h3>{% trans %}Login{% endtrans %}</h3>
  <p>
    {%- trans register=href('portal', 'register'), lost_password=href('portal', 'lost_password') -%}
      You can login here if you are already <a href="{{ register }}">registered</a>. If you lost your password, you can <a href="{{ lost_password }}">request a new one</a>.
    {%- endtrans -%}
  </p>
  {% include 'portal/login_text.html' with context %}
  <form action="" method="post" class="loginform">
		{{ csrf_token() }}
    <dl>
      {{ render_form(form, ['username', 'password'], inline=true) }}
      <dd>
        {{ form.permanent }} <label for="id_permanent">{{ form.permanent.label }}</label>
        <div class="help_text">{% trans -%}
          Donâ€™t choose this option if you are using a public computer. Otherwise, unauthorized persons may enter your account.
        {%- endtrans %}</div>
      </dd>
    </dl>
    <div class="actions">
      <input type="hidden" name="redirect" value="" />
      <input type="submit" id="login" value="{% trans %}Login{% endtrans %}" tabindex="1" />
    </div>
  </form>
  <form method="post" action="{{ href('portal', 'auth', 'complete', 'browserid') }}">
    <input type="hidden" name="assertion" value="" />
    <a rel="nofollow" id="browserid" href="#">BrowserID</a>
  </form>
{% endblock %}

{% block additional_scripts %}
  <script src="https://login.persona.org/include.js" type="text/javascript"></script>
  <script type="text/javascript">
      $(function () {
          $('#browserid').click(function (e) {
              e.preventDefault();
              var self = $(this);

              navigator.id.get(function (assertion) {
                  if (assertion) {
                      self.parent('form')
                              .find('input[type=hidden]')
                                  .attr('value', assertion)
                                  .end()
                              .submit();
                  } else {
                      alert('Some error occurred');
                  }
              });
          });
      });
  </script>
<!--
  <script type="text/javascript">
    /*<![CDATA[*/
    if ( $('#id_username')[0].value )
      $('#id_password').select().focus();
    else
      $('#id_username')[0].focus();

    var input = OpenIDHelper($('input[name="username"]'), {{ OPENID_PROVIDERS|jsonencode }});
    /*]]>*/
  </script>
-->
{% endblock %}
