{#
    ikhaya/detail.m.html
    ~~~~~~~~~~~~~~~~~~

    Show a single ikhaya article in mobile format.

    :copyright: (c) 2007-2013 by the Inyoka Team, see AUTHORS for more details.
    :license: GNU GPL, see LICENSE for more details.
#}
{%- extends 'ikhaya/page.m.html' %}

{% set back = href('ikhaya') %}

{% block content %}
  <article>
    <h2 class="title"><a href="{{ article|url }}">{{ article.subject|e }}</a></h2>
    <span class="meta">
      <span class="date">{{ article.pub_datetime|datetime }}</span> |
      <span class="author">
        {%- trans link=article.author|url, author=article.author.username|e -%}
          Published by <a href="{{ link }}">{{ author }}</a>
        {%- endtrans -%}
      </span> |
      <span class="category">
        {% trans %}Category:{% endtrans %} <a href="{{ article.category|url }}">{{ article.category.name|e }}</a>
      </span>
    </span>
    <div class="intro">
      {{ article.rendered_intro }}
    </div>
    <div class="text">
      {{ article.rendered_text }}
    </div>
  </article>
  {%- if article.comments_enabled %}
    <section id="comments">
      <h3>{% trans %}Comments{% endtrans %}</h3>
      {% for comment in comments %}
        {% if not comment.deleted %}
          <div class="comment" id="comment_{{ loop.index }}">
            <p class="meta">
              <span class="right">{{ comment.pub_date|datetime }}</span>
              <span class="left">
                <a href="#comment_{{ loop.index }}"><strong>{{ loop.index }}.</strong></a>
                <a href="{{ comment.author|url }}">{{ comment.author.username|e }}</a></span>
            </p>
            <div class="text">{{ comment.rendered_text }}</div>
          </div>
        {% endif %}
      {% endfor %}
    </section>
    {% if can_post_comment %}
      <section class="write-comment">
        {{ form.errors.text }}
        <form action="{{ article|url }}#new_comment" method="post" id="new_comment">
          {{ csrf_token() }}
          {{ form.text }}
          <div class="note">{{ form.fields.text.help_text }}</div>
          {% if form.data.comment_id and USER.can('comment_edit') %}
          {{ form.comment_id }}
          {% endif %}
          <div class="actions">
            <input type="submit" name="preview" value="{% trans %}Preview{% endtrans %}" />
            <input type="submit" value="{% trans %}Submit{% endtrans %}" />
          </div>
          {%- if preview %}
          <div class="preview_wrapper">
            <h2 class="title">{% trans %}Preview{% endtrans %}</h2>
            <div id="preview" class="preview">{{ preview }}</div>
          </div>
          {%- endif %}
        </form>
      </section>
    {% endif %}
  {%- endif %}
{% endblock %}
